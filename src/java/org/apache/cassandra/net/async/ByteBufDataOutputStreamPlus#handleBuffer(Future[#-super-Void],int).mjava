    /**
     * Handles the result of publishing a buffer to the channel.
     *
     * Note: this will be executed on the event loop.
     */
    private void handleBuffer(Future<? super Void> future, int bytesWritten)
    {
        channelRateLimiter.release(bytesWritten);
        logger.trace("bytesWritten {} {} because {}", bytesWritten, (future.isSuccess() == true) ? "Succeeded" : "Failed", future.cause());
        if (!future.isSuccess() && channel.isOpen())
            session.onError(future.cause());
    }

