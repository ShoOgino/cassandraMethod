    @Before
    public void setup()
    {
        OutboundConnectionIdentifier id = OutboundConnectionIdentifier.small(new InetSocketAddress("127.0.0.1", 0),
                                                                             new InetSocketAddress("127.0.0.2", 0));
        channel = new EmbeddedChannel();
        omc = new NonSendingOutboundMessagingConnection(id, null, Optional.empty());
        channelWriter = ChannelWriter.create(channel, omc::handleMessageResult, Optional.empty());
        channel.pipeline().addFirst(new MessageOutHandler(id, MessagingService.current_version, channelWriter, () -> null));
        coalescingStrategy = CoalescingStrategies.newCoalescingStrategy(CoalescingStrategies.Strategy.FIXED.name(), COALESCE_WINDOW_MS, null, "test");
    }

