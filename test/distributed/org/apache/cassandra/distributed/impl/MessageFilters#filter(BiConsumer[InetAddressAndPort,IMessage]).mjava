    public BiConsumer<InetAddressAndPort, IMessage> filter(BiConsumer<InetAddressAndPort, IMessage> applyIfNotFiltered)
    {
        return (toAddress, message) ->
        {
            IInstance from = cluster.get(message.from());
            IInstance to = cluster.get(toAddress);
            if (from == null || to == null)
                return; // cannot deliver
            int fromNum = from.config().num();
            int toNum = to.config().num();
            int verb = message.verb();
            for (Filter filter : filters)
            {
                if (filter.matches(fromNum, toNum, verb))
                    return;
            }

            applyIfNotFiltered.accept(toAddress, message);
        };
    }

