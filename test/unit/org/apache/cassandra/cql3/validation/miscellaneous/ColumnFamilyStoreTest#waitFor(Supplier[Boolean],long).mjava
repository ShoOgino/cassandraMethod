    public void waitFor(Supplier<Boolean> condition, long timeout)
    {
        long start = System.currentTimeMillis();
        while(true)
        {
            if (condition.get())
                return;

            assertTrue("Timeout ocurred while waiting for condition",
                       System.currentTimeMillis() - start < timeout);
        }
    }

