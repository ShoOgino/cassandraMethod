    @VisibleForTesting
    static boolean setStateIfNotClosed(AtomicReference<State> state, State newState)
    {
        State s = state.get();
        if (s == State.CLOSED)
            return false;
        state.set(newState);
        return true;
    }

