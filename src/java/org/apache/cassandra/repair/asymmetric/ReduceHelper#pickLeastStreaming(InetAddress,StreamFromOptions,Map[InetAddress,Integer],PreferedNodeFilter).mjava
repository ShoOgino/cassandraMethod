    // greedily pick the nodes doing the least amount of streaming
    private static Collection<InetAddress> pickLeastStreaming(InetAddress streamingNode,
                                                              StreamFromOptions toStreamFrom,
                                                              Map<InetAddress, Integer> outgoingStreamCounts,
                                                              PreferedNodeFilter filter)
    {
        Set<InetAddress> retSet = new HashSet<>();
        for (Set<InetAddress> toStream : toStreamFrom.allStreams())
        {
            InetAddress candidate = null;
            Set<InetAddress> prefered = filter.apply(streamingNode, toStream);
            for (InetAddress node : prefered)
            {
                if (candidate == null || outgoingStreamCounts.getOrDefault(candidate, 0) > outgoingStreamCounts.getOrDefault(node, 0))
                {
                    candidate = node;
                }
            }
            // ok, found no prefered hosts, try all of them
            if (candidate == null)
            {
                for (InetAddress node : toStream)
                {
                    if (candidate == null || outgoingStreamCounts.getOrDefault(candidate, 0) > outgoingStreamCounts.getOrDefault(node, 0))
                    {
                        candidate = node;
                    }
                }
            }
            assert candidate != null;
            outgoingStreamCounts.put(candidate, outgoingStreamCounts.getOrDefault(candidate, 0) + 1);
            retSet.add(candidate);
        }
        return retSet;
    }

