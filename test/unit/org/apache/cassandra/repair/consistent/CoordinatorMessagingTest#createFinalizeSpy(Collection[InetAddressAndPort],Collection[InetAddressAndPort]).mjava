    private MockMessagingSpy createFinalizeSpy(Collection<InetAddressAndPort> failed,
                                               Collection<InetAddressAndPort> timeout)
    {
        return MockMessagingService.when(
        all(verb(MessagingService.Verb.REPAIR_MESSAGE),
            payload((p) -> p instanceof FinalizePropose))
        ).respond((msgOut, to) ->
                  {
                      if(timeout.contains(to)) return null;
                      else return MessageIn.create(to,
                                                   new FinalizePromise(((FinalizePropose) msgOut.payload).sessionID, to, !failed.contains(to)),
                                                   Collections.emptyMap(),
                                                   MessagingService.Verb.REPAIR_MESSAGE,
                                                   MessagingService.current_version);
                  });
    }

