    @Before
    public void setup() throws IOException {
        tmd.clearUnsafe();
        IPartitioner partitioner = new RandomPartitioner();

        oldPartitioner = ss.setPartitionerUnsafe(partitioner);

        endpointTokens = new ArrayList<Token>();
        keyTokens = new ArrayList<Token>();
        hosts = new ArrayList<InetAddress>();

        // create a ring of 5 nodes
        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);

        MessagingService.instance.listen(FBUtilities.getLocalAddress());
        Gossiper.instance.start(FBUtilities.getLocalAddress(), 1);
        for(int i = 0; i < 6; i++) {
            Gossiper.instance.initializeNodeUnsafe(hosts.get(i), 1);
        }
    }

