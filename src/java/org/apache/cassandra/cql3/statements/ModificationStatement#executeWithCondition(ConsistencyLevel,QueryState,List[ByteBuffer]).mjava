    public ResultMessage executeWithCondition(ConsistencyLevel cl, QueryState queryState, List<ByteBuffer> variables)
    throws RequestExecutionException, RequestValidationException
    {
        List<ByteBuffer> keys = buildPartitionKeyNames(variables);
        // We don't support IN for CAS operation so far
        if (keys.size() > 1)
            throw new InvalidRequestException("IN on the partition key is not supported with conditional updates");

        ColumnNameBuilder clusteringPrefix = createClusteringPrefixBuilder(variables);
        UpdateParameters params = new UpdateParameters(cfm, variables, getTimestamp(queryState.getTimestamp(), variables), getTimeToLive(variables), null);

        ByteBuffer key = keys.get(0);
        ThriftValidation.validateKey(cfm, key);

        ColumnFamily updates = updateForKey(key, clusteringPrefix, params);
        ColumnFamily expected = buildConditions(key, clusteringPrefix, params);

        ColumnFamily result = StorageProxy.cas(keyspace(), columnFamily(), key, clusteringPrefix, expected, updates, cl);
        return result == null
             ? new ResultMessage.Void()
             : new ResultMessage.Rows(buildCasFailureResultSet(key, result));
    }

