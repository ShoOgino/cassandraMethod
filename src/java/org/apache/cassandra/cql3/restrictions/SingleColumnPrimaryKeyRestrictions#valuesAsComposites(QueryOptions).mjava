    @Override
    public List<Composite> valuesAsComposites(QueryOptions options) throws InvalidRequestException
    {
        CompositesBuilder builder = new CompositesBuilder(ctype.builder(), ctype);
        for (ColumnDefinition def : restrictions.getColumnDefs())
        {
            Restriction r = restrictions.getRestriction(def);
            assert !r.isSlice();

            List<ByteBuffer> values = r.values(options);

            if (values.isEmpty())
                return Collections.emptyList();

            builder.addEachElementToAll(values);
            checkFalse(builder.containsNull(), "Invalid null value for column %s", def.name);
        }

        return builder.build();
    }

