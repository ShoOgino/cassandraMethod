    @Test
    public void decode_AlreadyFailed()
    {
        handler.setState(State.HANDSHAKE_FAIL);
        buf = new FirstHandshakeMessage(MESSAGING_VERSION, MESSAGING, true).encode(PooledByteBufAllocator.DEFAULT);
        handler.decode(channel.pipeline().firstContext(), buf, new ArrayList<>());
        Assert.assertFalse(channel.isOpen());
        Assert.assertFalse(channel.isActive());
        Assert.assertSame(State.HANDSHAKE_FAIL, handler.getState());
    }

