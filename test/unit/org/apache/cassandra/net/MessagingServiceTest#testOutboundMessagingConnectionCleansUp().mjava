    @Test
    public void testOutboundMessagingConnectionCleansUp() throws Exception
    {
        MessagingService ms = MessagingService.instance();
        InetSocketAddress local = new InetSocketAddress("127.0.0.1", 9876);
        InetSocketAddress remote = new InetSocketAddress("127.0.0.2", 9876);

        OutboundMessagingPool pool = new OutboundMessagingPool(remote, local, null, new MockBackPressureStrategy(null).newState(remote.getAddress()), ALLOW_NOTHING_AUTHENTICATOR);
        ms.channelManagers.put(remote.getAddress(), pool);
        pool.sendMessage(new MessageOut(MessagingService.Verb.GOSSIP_DIGEST_ACK), 0);
        assertFalse(ms.channelManagers.containsKey(remote.getAddress()));
    }

