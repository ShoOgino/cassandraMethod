    @Override
    public void applyModels() throws IOException
    {
        if (!clientMode)
            renameKsStorageFiles(oldName, newName);
        
        KSMetaData oldKsm = DatabaseDescriptor.getTableDefinition(oldName);
        KSMetaData newKsm = KSMetaData.rename(oldKsm, newName, true);
        // ^^ at this point, the static methods in CFMetaData will start returning references to the new table, so
        // it helps if the node is reasonably quiescent with respect to this ks.
        DatabaseDescriptor.clearTableDefinition(oldKsm, newVersion);
        DatabaseDescriptor.setTableDefinition(newKsm, newVersion);
        
        if (!clientMode)
        {
            Table.clear(oldKsm.name);
            Table.open(newName);
            // this isn't strictly necessary since the set of all cfs was not modified.
            CommitLog.instance().forceNewSegment();
    
            HintedHandOffManager.renameHints(oldName, newName);
        }
    }

