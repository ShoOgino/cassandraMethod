    byte[] toByteArray() throws IOException
    {
        ByteArrayOutputStream bos = new ByteArrayOutputStream(maxSerializedSize);
        DataOutputStream dos = new DataOutputStream(bos);        
        serializer.serialize(this, dos);
        byte[] src = bos.toByteArray();
        assert src.length < maxSerializedSize;
        byte[] dst = new byte[maxSerializedSize];
        System.arraycopy(src, 0, dst, 0, src.length);
        return dst;
    }

