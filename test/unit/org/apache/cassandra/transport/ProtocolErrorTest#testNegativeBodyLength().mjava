    @Test
    public void testNegativeBodyLength() throws Exception
    {
        Frame.Decoder dec = new Frame.Decoder(null);

        byte[] frame = new byte[] {
                (byte) 0x82,  // direction & version
                0x00,  // flags
                0x01,  // stream ID
                0x09,  // opcode
                (byte) 0xff, (byte) 0xff, (byte) 0xff, (byte) 0xff,  // body length (-1)
        };
        ChannelBuffer buf = new HeapChannelBufferFactory().getBuffer(frame, 0, frame.length);
        try {
            dec.decode(null, null, buf);
        } catch (ErrorMessage.WrappedException e) {
            // make sure the exception has the correct stream ID
            Assert.assertEquals(1, e.getStreamId());
        }
    }

