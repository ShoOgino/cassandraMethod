        @VisibleForTesting
        int encodeFlags()
        {
            int flags = 0;
            if (compressionEnabled)
                flags |= 1 << 2;
            if (mode == NettyFactory.Mode.STREAMING)
                flags |= 1 << 3;

            flags |= (messagingVersion << 8);
            return flags;
        }

