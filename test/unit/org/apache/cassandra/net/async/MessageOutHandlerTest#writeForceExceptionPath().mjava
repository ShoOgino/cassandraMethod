    @Test
    public void writeForceExceptionPath()
    {
        IVersionedSerializer<Object> serializer = new IVersionedSerializer<Object>()
        {
            public void serialize(Object o, DataOutputPlus out, int version)
            {
                throw new RuntimeException("this exception is part of the test - DON'T PANIC");
            }

            public Object deserialize(DataInputPlus in, int version)
            {
                return null;
            }

            public long serializedSize(Object o, int version)
            {
                return 42;
            }
        };
        MessageOut message = new MessageOut(MessagingService.Verb.UNUSED_5, "payload", serializer);
        ChannelFuture future = channel.write(new QueuedMessage(message, 42));
        Throwable t = future.cause();
        Assert.assertNotNull(t);
        Assert.assertFalse(channel.isOpen());
        Assert.assertFalse(channel.releaseOutbound());
    }

