    @VisibleForTesting
    StreamPlan createStreamPlan(InetAddressAndPort dst, List<Range<Token>> differences)
    {
        StreamPlan plan = new StreamPlan(StreamOperation.REPAIR, 1, false, pendingRepair, previewKind)
                          .listeners(this)
                          .flushBeforeTransfer(pendingRepair == null)
                          .requestRanges(dst, desc.keyspace, differences, desc.columnFamily);  // request ranges from the remote node
        if (!pullRepair)
        {
            // send ranges to the remote node if we are not performing a pull repair
            plan.transferRanges(dst, desc.keyspace, differences, desc.columnFamily);
        }

        return plan;
    }

