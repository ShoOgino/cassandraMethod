    @Override
    public Cell reconcile(Cell cell, Allocator allocator)
    {
        // The only time this could happen is if a batchAdd ships two
        // increment for the same cell. Hence we simply sums the delta.

        assert (cell instanceof CounterUpdateCell) || (cell instanceof DeletedCell) : "Wrong class type.";

        // tombstones take precedence
        if (cell.isMarkedForDelete(Long.MIN_VALUE)) // can't be an expired cell, so the current time is irrelevant
            return timestamp() > cell.timestamp() ? this : cell;

        // neither is tombstoned
        CounterUpdateCell c = (CounterUpdateCell) cell;
        return new CounterUpdateCell(name(), delta() + c.delta(), Math.max(timestamp(), c.timestamp()));
    }

