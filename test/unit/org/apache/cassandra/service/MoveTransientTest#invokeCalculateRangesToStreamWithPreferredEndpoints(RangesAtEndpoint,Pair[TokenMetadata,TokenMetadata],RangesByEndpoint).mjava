    private void invokeCalculateRangesToStreamWithPreferredEndpoints(RangesAtEndpoint toStream,
                                                                     Pair<TokenMetadata, TokenMetadata> tmds,
                                                                     RangesByEndpoint expectedResult)
    {
        DatabaseDescriptor.setTransientReplicationEnabledUnsafe(true);
        StorageService.RangeRelocator relocator = new StorageService.RangeRelocator();
        RangesByEndpoint result = relocator.calculateRangesToStreamWithEndpoints(toStream,
                                                                                 simpleStrategy(tmds.left),
                                                                                 tmds.left,
                                                                                 tmds.right);
        logger.info("Ranges to stream by endpoint");
        logger.info(result.toString());
        assertMultimapEqualsIgnoreOrder(expectedResult, result);
    }

