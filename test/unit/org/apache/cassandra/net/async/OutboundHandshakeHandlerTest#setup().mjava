    @Before
    public void setup()
    {
        channel = new EmbeddedChannel(new ChannelOutboundHandlerAdapter());
        connectionId = OutboundConnectionIdentifier.small(localAddr, remoteAddr);
        callbackHandler = new CallbackHandler();
        params = OutboundConnectionParams.builder()
                                         .connectionId(connectionId)
                                         .callback(handshakeResult -> callbackHandler.receive(handshakeResult))
                                         .mode(NettyFactory.Mode.MESSAGING)
                                         .protocolVersion(MessagingService.current_version)
                                         .coalescingStrategy(Optional.empty())
                                         .build();
        handler = new OutboundHandshakeHandler(params);
        channel.pipeline().addFirst(HANDLER_NAME, handler);
    }

