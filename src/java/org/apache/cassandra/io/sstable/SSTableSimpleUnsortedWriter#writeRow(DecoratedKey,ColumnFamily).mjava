    protected void writeRow(DecoratedKey key, ColumnFamily columnFamily) throws IOException
    {
        ColumnFamily previous = keys.put(key, columnFamily);
        currentSize += key.key.remaining() + columnFamily.serializedSize() * 1.2;

        // Note that if the row was existing already, our size estimation will be slightly off
        // since we'll be counting the key multiple times.
        if (previous != null)
            columnFamily.addAll(previous, HeapAllocator.instance);

        if (currentSize > bufferSize)
            sync();
    }

