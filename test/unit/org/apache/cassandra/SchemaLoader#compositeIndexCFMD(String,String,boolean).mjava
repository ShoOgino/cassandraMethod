    public static CFMetaData compositeIndexCFMD(String ksName, String cfName, boolean withIndex) throws ConfigurationException
    {
        // the withIndex flag exists to allow tests index creation
        // on existing columns
        CFMetaData cfm = CFMetaData.Builder.create(ksName, cfName)
                .addPartitionKey("key", AsciiType.instance)
                .addClusteringColumn("c1", AsciiType.instance)
                .addRegularColumn("birthdate", LongType.instance)
                .addRegularColumn("notbirthdate", LongType.instance)
                .build();

        if (withIndex)
            cfm.indexes(
                cfm.getIndexes()
                   .with(IndexMetadata.singleTargetIndex(cfm,
                                                         new IndexTarget(new ColumnIdentifier("birthdate", true),
                                                                         IndexTarget.Type.VALUES),
                                                         "birthdate_key_index",
                                                         IndexMetadata.Kind.COMPOSITES,
                                                         Collections.EMPTY_MAP)));

        return cfm.compression(getCompressionParameters());
    }

