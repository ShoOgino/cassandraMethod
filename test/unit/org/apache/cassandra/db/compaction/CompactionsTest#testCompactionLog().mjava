    @Test
    public void testCompactionLog() throws Exception
    {
        SystemTable.discardCompactionsInProgress();
        SetMultimap<Pair<String, String>, Integer> compactionLogs = SystemTable.getUnfinishedCompactions();
        assert compactionLogs.isEmpty();

        String cf = "Standard1";
        ColumnFamilyStore cfs = Table.open(TABLE1).getColumnFamilyStore(cf);
        insertData(TABLE1, cf, 0, 1);
        cfs.forceBlockingFlush();

        Collection<SSTableReader> sstables = cfs.getSSTables();
        assert !sstables.isEmpty();
        Set<Integer> generations = Sets.newHashSet(Iterables.transform(sstables, new Function<SSTableReader, Integer>()
        {
            public Integer apply(SSTableReader sstable)
            {
                return sstable.descriptor.generation;
            }
        }));
        UUID taskId = SystemTable.startCompaction(cfs, sstables);
        compactionLogs = SystemTable.getUnfinishedCompactions();
        Set<Integer> unfinishedCompactions = compactionLogs.get(Pair.create(TABLE1, cf));
        assert unfinishedCompactions.containsAll(generations);

        SystemTable.finishCompaction(taskId);
        compactionLogs = SystemTable.getUnfinishedCompactions();
        assert compactionLogs.isEmpty();
    }

