    @Test
    public void testApplyToChannel() throws Exception
    {
        setUp();
        Object obj = new Object();
        Object retval = ndosp.applyToChannel( channel -> {
            ByteBuffer buf = ByteBuffer.allocate(8);
            buf.putLong(0, 42);
            try
            {
                channel.write(buf);
            }
            catch (Exception e)
            {
                throw new RuntimeException(e);
            }
            return obj;
        });
        assertEquals(obj, retval);
        assertEquals(42, ByteBuffer.wrap(generated.toByteArray()).getLong());
    }

