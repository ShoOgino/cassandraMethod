    public static TestCluster create(int nodeCount, File root)
    {
        root.mkdirs();
        setupLogging(root);

        IntFunction<ClassLoader> classLoaderFactory = InstanceClassLoader.createFactory(
                (URLClassLoader) Thread.currentThread().getContextClassLoader());
        List<Instance> instances = new ArrayList<>();
        long token = Long.MIN_VALUE + 1, increment = 2 * (Long.MAX_VALUE / nodeCount);
        for (int i = 0 ; i < nodeCount ; ++i)
        {
            InstanceConfig instanceConfig = InstanceConfig.generate(i + 1, root, String.valueOf(token));
            instances.add(new Instance(instanceConfig, classLoaderFactory.apply(i + 1)));
            token += increment;
        }

        TestCluster cluster = new TestCluster(root, instances);
        cluster.launch();
        return cluster;
    }

