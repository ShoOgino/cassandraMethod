    // Close the writer and return the descriptor to the new sstable and it's metadata
    public Pair<Descriptor, SSTableMetadata> close()
    {
        // index and filter
        iwriter.close();
        // main data, close will truncate if necessary
        dataFile.close();
        // write sstable statistics
        SSTableMetadata sstableMetadata = sstableMetadataCollector.finalizeMetadata(partitioner.getClass().getCanonicalName(),
                                                                                    metadata.getBloomFilterFpChance());
        writeMetadata(descriptor, sstableMetadata, sstableMetadataCollector.ancestors);

        // save the table of components
        SSTable.appendTOC(descriptor, components);

        // remove the 'tmp' marker from all components
        return Pair.create(rename(descriptor, components), sstableMetadata);
    }

