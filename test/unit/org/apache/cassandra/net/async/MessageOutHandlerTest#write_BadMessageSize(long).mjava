    private void write_BadMessageSize(long size)
    {
        IVersionedSerializer<Object> serializer = new IVersionedSerializer<Object>()
        {
            public void serialize(Object o, DataOutputPlus out, int version)
            {   }

            public Object deserialize(DataInputPlus in, int version)
            {
                return null;
            }

            public long serializedSize(Object o, int version)
            {
                return size;
            }
        };
        MessageOut message = new MessageOut(MessagingService.Verb.UNUSED_5, "payload", serializer);
        ChannelFuture future = channel.write(new QueuedMessage(message, 42));
        Throwable t = future.cause();
        Assert.assertNotNull(t);
        Assert.assertSame(IllegalStateException.class, t.getClass());
        Assert.assertTrue(channel.isOpen());
        Assert.assertFalse(channel.releaseOutbound());
    }

