    /**
     * @param key row to index
     * @param cfs ColumnFamily to index row in
     * @param indexedColumns columns to index, in comparator order
     */
    public static void indexRow(DecoratedKey key, ColumnFamilyStore cfs, SortedSet<ByteBuffer> indexedColumns)
    {
        if (logger.isDebugEnabled())
            logger.debug("Indexing row {} ", cfs.metadata.getKeyValidator().getString(key.key));

        switchLock.readLock().lock();
        try
        {
            synchronized (cfs.table.indexLockFor(key.key))
            {
                ColumnFamily cf = readCurrentIndexedColumns(key, cfs, indexedColumns);
                if (cf != null)
                    cfs.indexManager.applyIndexUpdates(key.key, cf, cf.getColumnNames(), null);
            }
        }
        finally
        {
            switchLock.readLock().unlock();
        }
    }

