    public long append(AbstractCompactedRow row) throws IOException
    {
        long currentPosition = beforeAppend(row.key);
        ByteBufferUtil.writeWithShortLength(row.key.key, dataFile.stream);
        row.write(dataFile.stream);
        // max timestamp is not collected here, because we want to avoid deserializing an EchoedRow
        // instead, it is collected when calling ColumnFamilyStore.createCompactionWriter
        sstableMetadataCollector.addRowSize(dataFile.getFilePointer() - currentPosition);
        sstableMetadataCollector.addColumnCount(row.columnCount());
        afterAppend(row.key, currentPosition);
        return currentPosition;
    }

