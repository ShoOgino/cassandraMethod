    /**
     * @return the last version associated with address, or @param version if this is the first such version
     */
    public int setVersion(InetAddress endpoint, int version)
    {
        // We can't talk to someone from the future
        version = Math.min(version, current_version);
        logger.trace("Setting version {} for {}", version, endpoint);

        Integer v = versions.put(endpoint, version);
        return v == null ? version : v;
    }

