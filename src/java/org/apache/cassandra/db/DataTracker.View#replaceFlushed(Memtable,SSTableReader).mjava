        View replaceFlushed(Memtable flushedMemtable, SSTableReader newSSTable)
        {
            int index = flushingMemtables.indexOf(flushedMemtable);
            List<Memtable> newQueuedMemtables = ImmutableList.<Memtable>builder()
                                                             .addAll(flushingMemtables.subList(0, index))
                                                             .addAll(flushingMemtables.subList(index + 1, flushingMemtables.size()))
                                                             .build();
            Map<SSTableReader, SSTableReader> newSSTables = sstablesMap;
            SSTableIntervalTree intervalTree = this.intervalTree;
            if (newSSTable != null)
            {
                assert !sstables.contains(newSSTable);
                assert !shadowed.contains(newSSTable);
                newSSTables = ImmutableMap.<SSTableReader, SSTableReader>builder()
                                          .putAll(sstablesMap).put(newSSTable, newSSTable).build();
                intervalTree = buildIntervalTree(newSSTables.keySet());
            }
            return new View(liveMemtables, newQueuedMemtables, newSSTables, compacting, shadowed, intervalTree);
        }

