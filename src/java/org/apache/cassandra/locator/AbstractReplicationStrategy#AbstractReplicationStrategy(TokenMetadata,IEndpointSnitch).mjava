    AbstractReplicationStrategy(TokenMetadata tokenMetadata, IEndpointSnitch snitch)
    {
        // TODO assert snitch != null some test code violates this
        assert tokenMetadata != null;
        this.tokenMetadata = tokenMetadata;
        this.snitch = snitch;
        cachedEndpoints = new NonBlockingHashMap<EndpointCacheKey, ArrayList<InetAddress>>();
        this.tokenMetadata.register(this);
    }

