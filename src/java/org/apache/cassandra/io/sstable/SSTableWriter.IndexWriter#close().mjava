        /**
         * Closes the index and bloomfilter, making the public state of this writer valid for consumption.
         */
        public void close()
        {
            String path = descriptor.filenameFor(SSTable.COMPONENT_FILTER);
            try
            {
                // bloom filter
                FileOutputStream fos = new FileOutputStream(path);
                DataOutputStream stream = new DataOutputStream(fos);
                FilterFactory.serialize(bf, stream, descriptor.version.filterType);
                stream.flush();
                fos.getFD().sync();
                stream.close();

                // index
                long position = indexFile.getFilePointer();
                indexFile.close(); // calls force
                FileUtils.truncate(indexFile.getPath(), position);
            }
            catch (IOException e)
            {
                throw new FSWriteError(e, path);
            }

            // finalize in-memory index state
            summary.complete();
        }

