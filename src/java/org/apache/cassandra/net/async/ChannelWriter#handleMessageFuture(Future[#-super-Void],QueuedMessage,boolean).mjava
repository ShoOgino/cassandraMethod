    /**
     * Handles the future of sending a particular message on this {@link ChannelWriter}.
     * <p>
     * Note: this is called from the netty event loop, so there is no race across multiple execution of this method.
     */
    @VisibleForTesting
    void handleMessageFuture(Future<? super Void> future, QueuedMessage msg, boolean allowReconnect)
    {
        messageResult.setAll(this, msg, future, allowReconnect);
        messageResultConsumer.accept(messageResult);
        messageResult.clearAll();
    }

