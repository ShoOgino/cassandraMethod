    public void write(ByteBuffer buffer) throws IOException
    {
        buffer = buffer.duplicate();
        while (buffer.remaining() > 0)
            channel.write(buffer);
    }

