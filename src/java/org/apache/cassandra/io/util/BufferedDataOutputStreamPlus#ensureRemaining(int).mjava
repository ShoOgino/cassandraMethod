    protected void ensureRemaining(int minimum) throws IOException
    {
        if (buffer.remaining() < minimum)
            doFlush();
    }

