    private static void deliverAllHints(ColumnFamilyStore columnFamilyStore)
    {
        logger_.debug("Started hinted handoff of " + columnFamilyStore.columnFamily_);

        // 1. Scan through all the keys that we need to handoff
        // 2. For each key read the list of recepients and send
        // 3. Delete that recepient from the key if write was successful
        // 4. If all writes were success for a given key we can even delete the key .
        // 5. Now force a flush
        // 6. Do major compaction to clean up all deletes etc.
        // 7. I guess we r done
        for ( String tableName:DatabaseDescriptor.getTables() )
        {
            Table table = Table.open(tableName);
            try
            {
                ColumnFamily hintColumnFamily = ColumnFamilyStore.removeDeleted(table.get(key_, Table.hints_), Integer.MAX_VALUE);
                if (hintColumnFamily == null)
                {
                    columnFamilyStore.forceFlush();
                    return;
                }
                Collection<IColumn> keys = hintColumnFamily.getAllColumns();
                if (keys == null)
                {
                    return;
                }

                for (IColumn keyColumn : keys)
                {
                    Collection<IColumn> endpoints = keyColumn.getSubColumns();
                    int deleted = 0;
                    for (IColumn endpoint : endpoints)
                    {
                        if (sendMessage(endpoint.name(), tableName, keyColumn.name()))
                        {
                            deleteEndPoint(endpoint.name(), tableName, keyColumn.name(), keyColumn.timestamp());
                            deleted++;
                        }
                    }
                    if (deleted == endpoints.size())
                    {
                        deleteHintedData(tableName, keyColumn.name());
                    }
                }
                columnFamilyStore.forceFlush();
                columnFamilyStore.forceCompaction(null, null, 0, null);
            }
            catch (Exception ex)
            {
                logger_.error(ex.getMessage());
            }
            finally
            {
                logger_.debug("Finished hinted handoff of " + columnFamilyStore.columnFamily_);
            }
        }
    }

