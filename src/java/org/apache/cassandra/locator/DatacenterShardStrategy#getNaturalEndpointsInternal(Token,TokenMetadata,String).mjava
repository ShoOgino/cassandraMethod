    private ArrayList<InetAddress> getNaturalEndpointsInternal(Token searchToken, TokenMetadata metadata, String table) throws UnknownHostException
    {
        ArrayList<InetAddress> endpoints = new ArrayList<InetAddress>();

        if (metadata.sortedTokens().size() == 0)
            return endpoints;

        if (tokensize != metadata.sortedTokens().size())
        {
            loadEndPoints(metadata);
        }

        for (String dc : dcTokens.keySet())
        {
            int replicas_ = getReplicationFactor(dc, table);
            List<Token> tokens = dcTokens.get(dc);
            boolean bOtherRack = false;
            boolean doneDataCenterItr;
            // Add the node at the index by default
            Iterator<Token> iter = TokenMetadata.ringIterator(tokens, searchToken);
            InetAddress primaryHost = metadata.getEndpoint(iter.next());
            endpoints.add(primaryHost);

            while (endpoints.size() < replicas_ && iter.hasNext())
            {
                Token t = iter.next();
                InetAddress endPointOfInterest = metadata.getEndpoint(t);
                if (endpoints.size() < replicas_ - 1)
                {
                	endpoints.add(endPointOfInterest);
                    continue;
                }
                else
                {
                    doneDataCenterItr = true;
                }

                // Now try to find one on a different rack
                if (!bOtherRack)
                {
                    if (!snitch.getRack(primaryHost).equals(snitch.getRack(endPointOfInterest)))
                    {
                    	endpoints.add(metadata.getEndpoint(t));
                        bOtherRack = true;
                    }
                }
                // If both already found exit loop.
                if (doneDataCenterItr && bOtherRack)
                {
                    break;
                }
            }

            /*
            * If we found N number of nodes we are good. This loop will just
            * exit. Otherwise just loop through the list and add until we
            * have N nodes.
            */
            if (forloopReturn.size() < replicas_)
            {
                iter = TokenMetadata.ringIterator(tokens, searchToken);
                while (forloopReturn.size() < replicas_ && iter.hasNext())
                {
                    Token t = iter.next();
                    if (!forloopReturn.contains(metadata.getEndpoint(t)))
                    {
                        forloopReturn.add(metadata.getEndpoint(t));
                    }
                }
            }
            endpoints.addAll(forloopReturn);
        }

        return endpoints;
    }

