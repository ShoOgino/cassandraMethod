        public ReplayPosition getReplayPosition()
        {
            // always allocate a ReplayPosition to let stack allocation do its magic. If we return null, we always
            // have to allocate an object on the stack
            return new ReplayPosition(segment == null ? -1 : segment.id, segment == null ? 0 : buffer.limit());
        }

