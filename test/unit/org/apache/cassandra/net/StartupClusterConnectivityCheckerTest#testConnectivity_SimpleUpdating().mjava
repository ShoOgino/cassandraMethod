    @Test
    public void testConnectivity_SimpleUpdating() throws UnknownHostException
    {
        UpdatablePredicate predicate = new UpdatablePredicate();
        final int count = 100;
        final int thresholdPercentage = 70;
        StartupClusterConnectivityChecker connectivityChecker = new StartupClusterConnectivityChecker(thresholdPercentage, 10, predicate);
        Set<InetAddressAndPort> peers = createNodes(count);

        AtomicInteger connectedCount = new AtomicInteger();

        for (int i = 0; i < count; i++)
        {
            predicate.reset(i);
            connectedCount.set(i * 2);
            StartupClusterConnectivityChecker.State expectedState = i < thresholdPercentage ?
                                                                    StartupClusterConnectivityChecker.State.CONTINUE :
                                                                    StartupClusterConnectivityChecker.State.FINISH_SUCCESS;
            Assert.assertEquals("failed on iteration " + i,
                                expectedState, connectivityChecker.checkStatus(peers, connectedCount, System.nanoTime(), false, i));
        }
    }

