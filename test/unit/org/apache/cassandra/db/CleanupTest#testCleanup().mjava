    @Test
    public void testCleanup() throws IOException, ExecutionException, InterruptedException
    {
        Table table = Table.open(TABLE1);

        ColumnFamilyStore cfs = table.getColumnFamilyStore(CF1);
        fillCF(cfs, LOOPS);

        assertEquals(cfs.getIndexedColumns().iterator().next(), COLUMN);

        ColumnFamilyStore cfi = cfs.getIndexedColumnFamilyStore(COLUMN);

        assertTrue(cfi.isIndexBuilt());

        IndexExpression expr = new IndexExpression(COLUMN, IndexOperator.EQ, VALUE);
        IndexClause clause = new IndexClause(Arrays.asList(expr), FBUtilities.EMPTY_BYTE_BUFFER, Integer.MAX_VALUE);
        IFilter filter = new IdentityQueryFilter();
        IPartitioner p = StorageService.getPartitioner();
        Range range = new Range(p.getMinimumToken(), p.getMinimumToken());
        List<Row> rows = table.getColumnFamilyStore(CF1).scan(clause, range, filter);

        assertEquals(LOOPS, rows.size());

        TokenMetadata tmd = StorageService.instance.getTokenMetadata();

        assertNotNull(tmd);
        assertEquals(0, tmd.getTokenToEndpointMap().size());

        // Since this test has no ring cleanup will remove all
        CompactionManager.instance.performCleanup(cfs);

        // row data should be gone
        rows = cfs.getRangeSlice(null, Util.range("", ""), 1000, new IdentityQueryFilter());
        assertEquals(0, rows.size());

        // not only should it be gone but there should be no data on disk, not even tombstones
        assert cfs.getSSTables().isEmpty();

        // 2ary indexes should result in no results, but
        rows = cfs.scan(clause, range, filter);
        assertEquals(0, rows.size());
    }

