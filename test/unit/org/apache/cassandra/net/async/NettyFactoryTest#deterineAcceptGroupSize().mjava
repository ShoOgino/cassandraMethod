    @Test
    public void deterineAcceptGroupSize()
    {
        ServerEncryptionOptions serverEncryptionOptions = new ServerEncryptionOptions();
        serverEncryptionOptions.enabled = false;
        Assert.assertEquals(1, NettyFactory.determineAcceptGroupSize(serverEncryptionOptions));
        serverEncryptionOptions.enabled = true;
        Assert.assertEquals(1, NettyFactory.determineAcceptGroupSize(serverEncryptionOptions));

        serverEncryptionOptions.enable_legacy_ssl_storage_port = true;
        Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(serverEncryptionOptions));
        serverEncryptionOptions.enable_legacy_ssl_storage_port = false;

        InetAddress originalBroadcastAddr = FBUtilities.getBroadcastAddress();
        try
        {
            FBUtilities.setBroadcastInetAddress(InetAddresses.increment(FBUtilities.getLocalAddress()));
            DatabaseDescriptor.setListenOnBroadcastAddress(true);

            serverEncryptionOptions.enabled = false;
            Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(serverEncryptionOptions));
            serverEncryptionOptions.enabled = true;
            Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(serverEncryptionOptions));

            serverEncryptionOptions.enable_legacy_ssl_storage_port = true;
            Assert.assertEquals(4, NettyFactory.determineAcceptGroupSize(serverEncryptionOptions));
        }
        finally
        {
            FBUtilities.setBroadcastInetAddress(originalBroadcastAddr);
            DatabaseDescriptor.setListenOnBroadcastAddress(false);
        }
    }

