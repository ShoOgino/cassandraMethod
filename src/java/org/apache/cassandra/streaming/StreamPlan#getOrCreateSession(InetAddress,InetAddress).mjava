    private StreamSession getOrCreateSession(InetAddress peer, InetAddress preferred)
    {
        StreamSession session = sessions.get(peer);
        if (session == null)
        {
            session = new StreamSession(peer, preferred, connectionFactory);
            sessions.put(peer, session);
        }
        return session;
    }

