    /**
     * Create the index metadata for the index on a given column of a given table.
     */
    static CFMetaData newIndexMetadata(CFMetaData baseMetadata, IndexMetadata def, AbstractType<?> comparator)
    {
        assert !def.isCustom();

        CFMetaData.Builder builder = CFMetaData.Builder.create(baseMetadata.ksName, baseMetadata.indexColumnFamilyName(def))
                                                       .withId(baseMetadata.cfId)
                                                       .withPartitioner(new LocalPartitioner(comparator))
                                                       .addPartitionKey(def.indexedColumn(baseMetadata).name, comparator);

        if (def.isComposites())
        {
            CompositesIndex.addIndexClusteringColumns(builder, baseMetadata, def);
        }
        else
        {
            assert def.isKeys();
            KeysIndex.addIndexClusteringColumns(builder, baseMetadata);
        }

        return builder.build().reloadIndexMetadataProperties(baseMetadata);
    }

