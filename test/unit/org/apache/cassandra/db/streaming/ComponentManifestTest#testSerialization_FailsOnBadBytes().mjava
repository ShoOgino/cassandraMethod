    @Test(expected = EOFException.class)
    public void testSerialization_FailsOnBadBytes() throws IOException
    {
        ByteBuf buf = Unpooled.buffer(512);
        ComponentManifest expected = new ComponentManifest(new LinkedHashMap<Component, Long>() {{ put(Component.DATA, 100L); }});

        DataOutputPlus output = new ByteBufDataOutputPlus(buf);
        ComponentManifest.serializer.serialize(expected, output, MessagingService.VERSION_40);

        buf.setInt(0, -100);

        DataInputPlus input = new ByteBufDataInputPlus(buf);
        ComponentManifest actual = ComponentManifest.serializer.deserialize(input, MessagingService.VERSION_40);

        assertNotEquals(expected, actual);
    }

