    /*
     * This method updates the token on disk and modifies the cached
     * StorageMetadata instance. This is only for the local endpoint.
    */
    public void updateToken(Token token) throws IOException
    {
        if (logger_.isDebugEnabled())
          logger_.debug("Setting token to " + token);
        /* update the token on disk */
        SystemTable.updateToken(token);
        /* Update the token maps */
        tokenMetadata_.update(token, FBUtilities.getLocalAddress());
        /* Gossip this new token for the local storage instance */
        ApplicationState state = new ApplicationState(StorageService.getPartitioner().getTokenFactory().toString(token));
        Gossiper.instance().addApplicationState(StorageService.nodeId_, state);
    }

