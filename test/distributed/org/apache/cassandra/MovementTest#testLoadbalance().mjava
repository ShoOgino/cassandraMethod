    @Test
    public void testLoadbalance() throws Exception
    {
        final String keyspace = "TestLoadbalance";
        addKeyspace(keyspace, 1);
        List<InetAddress> hosts = controller.getHosts();
        Cassandra.Client client = controller.createClient(hosts.get(0));
        client.set_keyspace(keyspace);

        // add keys to each node
        Map<ByteBuffer,List<ColumnOrSuperColumn>> rows = insertBatch(client);

        Thread.sleep(100);

        // ask a node to move to a new location
        controller.nodetool("loadbalance", hosts.get(0));

        // trigger cleanup on all nodes
        for (InetAddress host : hosts)
            controller.nodetool("cleanup", host);

        // check that all keys still exist
        verifyBatch(client, rows);
    }

