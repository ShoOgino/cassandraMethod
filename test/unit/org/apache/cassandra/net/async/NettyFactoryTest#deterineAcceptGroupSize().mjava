    @Test
    public void deterineAcceptGroupSize()
    {
        Assert.assertEquals(1, NettyFactory.determineAcceptGroupSize(InternodeEncryption.none));
        Assert.assertEquals(1, NettyFactory.determineAcceptGroupSize(InternodeEncryption.all));
        Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(InternodeEncryption.rack));
        Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(InternodeEncryption.dc));

        InetAddress originalBroadcastAddr = FBUtilities.getBroadcastAddress();
        try
        {
            FBUtilities.setBroadcastInetAddress(InetAddresses.increment(FBUtilities.getLocalAddress()));
            DatabaseDescriptor.setListenOnBroadcastAddress(true);

            Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(InternodeEncryption.none));
            Assert.assertEquals(2, NettyFactory.determineAcceptGroupSize(InternodeEncryption.all));
            Assert.assertEquals(4, NettyFactory.determineAcceptGroupSize(InternodeEncryption.rack));
            Assert.assertEquals(4, NettyFactory.determineAcceptGroupSize(InternodeEncryption.dc));
        }
        finally
        {
            FBUtilities.setBroadcastInetAddress(originalBroadcastAddr);
            DatabaseDescriptor.setListenOnBroadcastAddress(false);
        }
    }

