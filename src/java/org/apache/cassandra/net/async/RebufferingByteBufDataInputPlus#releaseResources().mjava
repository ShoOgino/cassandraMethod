    private void releaseResources()
    {
        if (currentBuf != null)
        {
            if (currentBuf.refCnt() > 0)
                currentBuf.release(currentBuf.refCnt());
            currentBuf = null;
            buffer = null;
        }

        ByteBuf buf;
        while ((buf = queue.poll()) != null && buf.refCnt() > 0)
            buf.release(buf.refCnt());
    }

