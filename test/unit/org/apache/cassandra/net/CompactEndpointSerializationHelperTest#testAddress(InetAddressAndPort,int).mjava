    private void testAddress(InetAddressAndPort address, int version) throws Exception
    {
        ByteBuffer out;
        try (DataOutputBuffer dob = new DataOutputBuffer())
        {
            CompactEndpointSerializationHelper.instance.serialize(address, dob, version);
            out = dob.buffer();
        }
        assertEquals(out.remaining(), CompactEndpointSerializationHelper.instance.serializedSize(address, version));

        InetAddressAndPort roundtripped;
        try (DataInputBuffer dib = new DataInputBuffer(out, false))
        {
            roundtripped = CompactEndpointSerializationHelper.instance.deserialize(dib, version);
        }

        if (version >= MessagingService.VERSION_40)
        {
            assertEquals(address, roundtripped);
        }
        else
        {
            assertEquals(roundtripped.address, address.address);
            assertEquals(7000, roundtripped.port);
        }
    }

