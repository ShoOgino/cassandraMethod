    // TODO: we could probably refactor processResults so it doesn't needs the variables, so we don't have to keep around. But that can wait.
    private ResultMessage.Rows setupPaging(QueryPager pager, QueryState state, List<ByteBuffer> variables, int limit, int pageSize) throws RequestValidationException, RequestExecutionException
    {
        List<Row> page = pager.fetchPage(pageSize);

        ResultMessage.Rows msg = processResults(page, variables, limit, pager.timestamp());

        // Don't bother setting up the pager if we actually don't need to.
        if (pager.isExhausted())
            return msg;

        state.attachPager(pager, this, variables);
        msg.result.metadata.setHasMorePages();
        return msg;
    }

