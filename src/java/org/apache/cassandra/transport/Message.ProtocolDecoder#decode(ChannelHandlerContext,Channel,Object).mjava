        public Object decode(ChannelHandlerContext ctx, Channel channel, Object msg)
        {
            assert msg instanceof Frame : "Expecting frame, got " + msg;

            Frame frame = (Frame)msg;
            Message message = frame.header.type.codec.decode(frame.body);
            if (message instanceof Request)
                ((Request)message).attach(frame.connection);
            return message;
        }

