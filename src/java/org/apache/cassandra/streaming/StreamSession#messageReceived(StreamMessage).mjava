    public void messageReceived(StreamMessage message)
    {
        switch (message.type)
        {
            case STREAM_INIT:
                // nop
                break;
            case PREPARE_SYN:
                PrepareSynMessage msg = (PrepareSynMessage) message;
                prepare(msg.requests, msg.summaries);
                break;
            case PREPARE_SYNACK:
                prepareSynAck((PrepareSynAckMessage) message);
                break;
            case PREPARE_ACK:
                prepareAck((PrepareAckMessage) message);
                break;
            case FILE:
                receive((IncomingFileMessage) message);
                break;
            case RECEIVED:
                ReceivedMessage received = (ReceivedMessage) message;
                received(received.tableId, received.sequenceNumber);
                break;
            case COMPLETE:
                complete();
                break;
            case KEEP_ALIVE:
                // NOP - we only send/receive the KEEP_ALIVE to force the TCP connection to remain open
                break;
            case SESSION_FAILED:
                sessionFailed();
                break;
            default:
                throw new AssertionError("unhandled StreamMessage type: " + message.getClass().getName());
        }
    }

