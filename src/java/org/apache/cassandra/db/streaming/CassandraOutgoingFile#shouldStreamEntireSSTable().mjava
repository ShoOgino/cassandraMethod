    @VisibleForTesting
    public boolean shouldStreamEntireSSTable()
    {
        // don't stream if full sstable transfers are disabled or legacy counter shards are present
        if (!DatabaseDescriptor.streamEntireSSTables() || ref.get().getSSTableMetadata().hasLegacyCounterShards)
            return false;

        ColumnFamilyStore cfs = ColumnFamilyStore.getIfExists(getTableId());

        if (cfs == null)
            return false;

        AbstractCompactionStrategy compactionStrategy = cfs.getCompactionStrategyManager()
                                                           .getCompactionStrategyFor(ref.get());

        if (compactionStrategy instanceof LeveledCompactionStrategy)
            return contained(normalizedRanges, ref.get());

        return false;
    }

