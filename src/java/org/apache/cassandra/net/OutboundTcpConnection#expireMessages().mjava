    private void expireMessages()
    {
        while (true)
        {
            QueuedMessage message = backlog.peek();
            if (message == null || message.timestamp >= System.currentTimeMillis() - message.message.getTimeout())
                break;

            QueuedMessage message2 = backlog.poll();
            if (message2 != message)
            {
                // sending thread switched queues.  add this entry (from the "new" backlog)
                // at the end of the active queue, which keeps it in the same position relative to the other entries
                // without having to contend with other clients for the head-of-backlog lock.
                if (message2 != null)
                    active.add(message2);
                break;
            }

            dropped.incrementAndGet();
        }
    }

