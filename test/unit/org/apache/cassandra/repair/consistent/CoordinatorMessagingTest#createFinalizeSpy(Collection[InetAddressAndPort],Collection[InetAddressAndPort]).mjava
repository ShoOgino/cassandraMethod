    private MockMessagingSpy createFinalizeSpy(Collection<InetAddressAndPort> failed,
                                               Collection<InetAddressAndPort> timeout)
    {
        return MockMessagingService.when(
        all(verb(Verb.REPAIR_REQ),
            payload((p) -> p instanceof FinalizePropose))
        ).respond((msgOut, to) ->
                  {
                      if(timeout.contains(to)) return null;
                      else return Message.out(Verb.REPAIR_REQ,
                                                  new FinalizePromise(((FinalizePropose) msgOut.payload).sessionID, to, !failed.contains(to)));
                  });
    }

