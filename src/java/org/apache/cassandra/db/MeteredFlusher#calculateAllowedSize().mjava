    private long calculateAllowedSize()
    {
        long allowed = DatabaseDescriptor.getTotalMemtableSpaceInMB() * 1048576L;
        // deduct the combined memory limit of the tables unaffected by the metered flusher (we don't flush them, we
        // should not count their limits to the total limit either).
        for (ColumnFamilyStore cfs : ColumnFamilyStore.all())
            if (!cfs.getCompactionStrategy().isAffectedByMeteredFlusher())
                allowed -= cfs.getCompactionStrategy().getMemtableReservedSize();
        return allowed;
    }

