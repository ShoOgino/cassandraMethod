    @Test (expected = IOException.class)
    public void handleStart_BadMagic() throws IOException
    {
        InboundHandshakeHandler handler = new InboundHandshakeHandler(new TestAuthenticator(false));
        EmbeddedChannel channel = new EmbeddedChannel(handler);
        buf = Unpooled.buffer(32, 32);

        FirstHandshakeMessage first = new FirstHandshakeMessage(MESSAGING_VERSION,
                                                                MESSAGING,
                                                                true);

        buf.writeInt(MessagingService.PROTOCOL_MAGIC << 2);
        buf.writeInt(first.encodeFlags());
        handler.handleStart(channel.pipeline().firstContext(), buf);
    }

