    /**
     * Return the digest associated to this file or null if no digest was
     * created.
     * This can only be called once the file is fully created, i.e. after
     * close() has been called. Otherwise an IllegalStateException is thrown.
     */
    public byte[] digest()
    {
        if (buffer != null)
            throw new IllegalStateException();

        return digest == null ? null : digest.digest();
    }

