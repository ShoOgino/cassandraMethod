    @Test
    public void writeBacklog_ChannelNotWritable()
    {
        Assert.assertTrue(channel.isWritable());
        // force the channel to be non writable
        channel.config().setOption(ChannelOption.WRITE_BUFFER_WATER_MARK, new WriteBufferWaterMark(1, 2));
        ByteBuf buf = channel.alloc().buffer(8, 8);
        channel.unsafe().outboundBuffer().addMessage(buf, buf.capacity(), channel.newPromise());
        Assert.assertFalse(channel.isWritable());

        Assert.assertEquals(0, channelWriter.writeBacklog(new LinkedBlockingQueue<>(), false));
        Assert.assertFalse(channel.releaseOutbound());
        Assert.assertFalse(channel.isWritable());
        buf.release();
    }

