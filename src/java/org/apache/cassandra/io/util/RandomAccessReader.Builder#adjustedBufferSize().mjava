        /** The buffer size is typically already page aligned but if that is not the case
         * make sure that it is a multiple of the page size, 4096. Also limit it to the maximum
         * buffer size unless we are throttling, in which case we may as well read the maximum
         * directly since the intention is to read the full file, see CASSANDRA-8630.
         * */
        private int adjustedBufferSize()
        {
            if (limiter != null)
                return MAX_BUFFER_SIZE;

            // should already be a page size multiple but if that's not case round it up
            int wholePageSize = (bufferSize + 4095) & ~4095;
            return Math.min(MAX_BUFFER_SIZE, wholePageSize);
        }

