        /**
         * Gets the repairing sstables for anticompaction.
         *
         * Note that validation and streaming uses the real unrepaired sstables.
         *
         * @param cfId
         * @return
         */
        @SuppressWarnings("resource")
        public synchronized Refs<SSTableReader> getActiveRepairedSSTableRefsForAntiCompaction(UUID cfId)
        {
            assert marked.contains(cfId);
            ImmutableMap.Builder<SSTableReader, Ref<SSTableReader>> references = ImmutableMap.builder();
            Iterable<SSTableReader> sstables = getActiveSSTables(cfId);
            if (sstables == null)
                throw new RuntimeException("Not possible to get sstables for anticompaction for " + cfId);
            for (SSTableReader sstable : sstables)
            {
                Ref<SSTableReader> ref = sstable.tryRef();
                if (ref == null)
                    sstableMap.get(cfId).remove(sstable.getFilename());
                else
                    references.put(sstable, ref);
            }
            return new Refs<>(references.build());
        }

