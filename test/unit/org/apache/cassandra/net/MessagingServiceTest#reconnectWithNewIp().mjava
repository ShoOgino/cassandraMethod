    @Test
    public void reconnectWithNewIp() throws Exception
    {
        InetAddressAndPort publicIp = InetAddressAndPort.getByName("127.0.0.2");
        InetAddressAndPort privateIp = InetAddressAndPort.getByName("127.0.0.3");

        // reset the preferred IP value, for good test hygene
        SystemKeyspace.updatePreferredIP(publicIp, publicIp);

        // create pool/conn with public addr
        Assert.assertEquals(publicIp, messagingService.getCurrentEndpoint(publicIp));
        messagingService.reconnectWithNewIp(publicIp, privateIp);
        Assert.assertEquals(privateIp, messagingService.getCurrentEndpoint(publicIp));

        messagingService.destroyConnectionPool(publicIp);

        // recreate the pool/conn, and make sure the preferred ip addr is used
        Assert.assertEquals(privateIp, messagingService.getCurrentEndpoint(publicIp));
    }

