    private static void shutdownAndWait(ExecutorService executor)
    {
        try
        {
            executor.shutdownNow();
            executor.awaitTermination(20, TimeUnit.SECONDS);
        }
        catch (InterruptedException e)
        {
            throw new RuntimeException(e);
        }
        assert executor.isTerminated() && executor.isShutdown() : executor;
    }

