    public static List<Row> scan(IndexScanCommand command, ConsistencyLevel consistency_level)
    throws IOException, TimeoutException
    {
        IPartitioner p = StorageService.getPartitioner();
        Token startToken = command.index_clause.start_key == null ? p.getMinimumToken() : p.getToken(command.index_clause.start_key);
        List<InetAddress> endpoints = StorageService.instance.getLiveNaturalEndpoints(command.keyspace, startToken);
        // TODO iterate through endpoints in token order like getRangeSlice
        Message message = command.getMessage();
        RangeSliceResponseResolver resolver = new RangeSliceResponseResolver(command.keyspace, endpoints);
        AbstractReplicationStrategy rs = StorageService.instance.getReplicationStrategy(command.keyspace);
        QuorumResponseHandler<List<Row>> handler = rs.getQuorumResponseHandler(resolver, consistency_level, command.keyspace);
        MessagingService.instance.sendRR(message, endpoints.get(0), handler);
        try
        {
            return handler.get();
        }
        catch (DigestMismatchException e)
        {
            throw new RuntimeException(e);
        }
    }

