    @Test
    public void testCounterDeletion()
    {
        long timestamp = FBUtilities.timestampMicros();
        CellName name = cellname("counter1");

        BufferCounterCell counter = new BufferCounterCell(name,
                                                          CounterContext.instance().createGlobal(CounterId.fromInt(1), 1, 1),
                                                          timestamp);
        BufferDeletedCell tombstone = new BufferDeletedCell(name, (int) (System.currentTimeMillis() / 1000), 0L);

        // check that the tombstone won the reconcile despite the counter cell having a higher timestamp
        assertTrue(counter.reconcile(tombstone) == tombstone);

        // check that a range tombstone overrides the counter cell, even with a lower timestamp than the counter
        ColumnFamily cf0 = ArrayBackedSortedColumns.factory.create("Keyspace1", "Counter1");
        cf0.addColumn(counter);
        cf0.delete(new RangeTombstone(cellname("counter0"), cellname("counter2"), 0L, (int) (System.currentTimeMillis() / 1000)));
        assertTrue(cf0.deletionInfo().isDeleted(counter));
        assertTrue(cf0.deletionInfo().inOrderTester(false).isDeleted(counter));

        // check that a top-level deletion info overrides the counter cell, even with a lower timestamp than the counter
        ColumnFamily cf1 = ArrayBackedSortedColumns.factory.create("Keyspace1", "Counter1");
        cf1.addColumn(counter);
        cf1.delete(new DeletionInfo(0L, (int) (System.currentTimeMillis() / 1000)));
        assertTrue(cf1.deletionInfo().isDeleted(counter));
    }

