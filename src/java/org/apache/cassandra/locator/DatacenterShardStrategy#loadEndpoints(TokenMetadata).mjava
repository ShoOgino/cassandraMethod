    private synchronized void loadEndpoints(TokenMetadata metadata) throws UnknownHostException
    {
        String localDC = snitch.getDatacenter(DatabaseDescriptor.getListenAddress());
        assert (localDC != null) : "Invalid configuration, Coldn't find the host: " + FBUtilities.getLocalAddress();
        // re -init the map
        dcTokens = new HashMap<String, List<Token>>();
        List<Token> tokens = metadata.sortedTokens();
        for (Token token : tokens)
        {
            InetAddress endPoint = metadata.getEndpoint(token);
            String dataCenter = snitch.getDatacenter(endPoint);
            // add tokens to dcmap.
            List<Token> lst = dcTokens.get(dataCenter);
            if (lst == null)
            {
                lst = new ArrayList<Token>();
            }
            lst.add(token);
            dcTokens.put(dataCenter, lst);
        }
        for (Entry<String, List<Token>> entry : dcTokens.entrySet())
        {
            List<Token> valueList = entry.getValue();
            Collections.sort(valueList);
            dcTokens.put(entry.getKey(), valueList);
        }
        tokensize = tokens.size();
    }

