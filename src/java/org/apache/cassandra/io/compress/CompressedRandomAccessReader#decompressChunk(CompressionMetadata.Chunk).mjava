    private void decompressChunk(CompressionMetadata.Chunk chunk) throws IOException
    {
        if (source.getChannel().position() != chunk.offset)
            source.getChannel().position(chunk.offset);

        if (source.read(compressed, 0, chunk.length) != chunk.length)
            throw new IOException(String.format("(%s) failed to read %d bytes from offset %d.", getPath(), chunk.length, chunk.offset));

        validBufferBytes = Snappy.rawUncompress(compressed, 0, chunk.length, buffer, 0);

        // buffer offset is always aligned
        bufferOffset = current & ~(buffer.length - 1);
    }

