    @Test
    public void testBytesPastMark() throws IOException
    {
        File tmpFile = File.createTempFile("overflowtest", "bin");
        tmpFile.deleteOnExit();

        // Create the BRAF by filename instead of by file.
        final BufferedRandomAccessFile rw = new BufferedRandomAccessFile(tmpFile.getPath(), "rw");
        assert tmpFile.getPath().equals(rw.getPath());

        // Create a mark and move the rw there.
        final FileMark mark = rw.mark();
        rw.reset(mark);

        // Expect this call to succeed.
        rw.bytesPastMark(mark);

        // Seek 4gb
        rw.seek(4L*1024L*1024L*1024L*1024L);

        // Expect this call to fail -- the distance from mark to current file pointer > 2gb.
        expectException(new Callable<Object>()
        {
            public Object call() throws IOException
            {
                return rw.bytesPastMark(mark);
            }
        }, UnsupportedOperationException.class);
    }

