    @Test
    public void failHandshake_TaskIsCancelled()
    {
        ChannelPromise future = channel.newPromise();
        future.cancel(false);
        handler.setHandshakeTimeout(future);
        handler.setState(State.AWAIT_MESSAGING_START_RESPONSE);
        Assert.assertTrue(channel.isOpen());
        handler.failHandshake(channel.pipeline().firstContext());
        Assert.assertSame(State.AWAIT_MESSAGING_START_RESPONSE, handler.getState());
        Assert.assertTrue(channel.isOpen());
    }

