    @Setup
    public void setup()
    {
        DatabaseDescriptor.daemonInitialization();
        InetAddressAndPort addr = InetAddressAndPort.getByAddress(InetAddresses.forString("127.0.73.101"));

        UUID uuid = UUIDGen.getTimeUUID();
        Map<ParameterType, Object> parameters = new EnumMap<>(ParameterType.class);

        if (withParams)
        {
            parameters.put(ParameterType.FAILURE_RESPONSE, MessagingService.ONE_BYTE);
            parameters.put(ParameterType.FAILURE_REASON, Shorts.checkedCast(RequestFailureReason.READ_TOO_MANY_TOMBSTONES.code));
            parameters.put(ParameterType.TRACE_SESSION, uuid);
        }

        msgOut = new MessageOut<>(addr, MessagingService.Verb.ECHO, null, null, ImmutableList.of(), SMALL_MESSAGE);
        buf = Unpooled.buffer(1024, 1024); // 1k should be enough for everybody!

        handler40 = new MessageInHandler(addr, MessagingService.VERSION_40, messageConsumer);
        handlerPre40 = new MessageInHandlerPre40(addr, MessagingService.VERSION_30, messageConsumer);
    }

