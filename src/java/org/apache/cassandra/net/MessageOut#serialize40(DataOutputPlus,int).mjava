    private void serialize40(DataOutputPlus out, int version) throws IOException
    {
        out.writeInt(verb.getId());

        // serialize the headers, if any
        assert parameters.size() % PARAMETER_TUPLE_SIZE == 0;
        if (parameters.isEmpty())
        {
            out.writeVInt(0);
        }
        else
        {
            try (DataOutputBuffer buf = new DataOutputBuffer())
            {
                serializeParams(buf, version);
                out.writeUnsignedVInt(buf.getLength());
                out.write(buf.buffer());
            }
        }

        if (payload != null)
        {
            int payloadSize = payloadSerializedSize >= 0
                              ? payloadSerializedSize
                              : (int) serializer.serializedSize(payload, version);

            out.writeUnsignedVInt(payloadSize);
            serializer.serialize(payload, out, version);
        }
        else
        {
            out.writeUnsignedVInt(0);
        }
    }

