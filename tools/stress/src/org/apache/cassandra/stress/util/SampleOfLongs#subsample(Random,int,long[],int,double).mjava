    private static double subsample(Random rnd, int maxSamples, long[] sample, int count, double p)
    {
        // want exactly maxSamples, so select random indexes up to maxSamples
        for (int i = 0 ; i < maxSamples ; i++)
        {
            int take = i + rnd.nextInt(count - i);
            long tmp = sample[i];
            sample[i] = sample[take];
            sample[take] = tmp;
        }

        // calculate new p; have selected with probability maxSamples / count
        // so multiply p by this probability
        p *= maxSamples / (double) sample.length;
        return p;
    }

