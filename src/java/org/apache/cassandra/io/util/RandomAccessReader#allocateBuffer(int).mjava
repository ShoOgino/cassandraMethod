    protected ByteBuffer allocateBuffer(int bufferSize)
    {
        return ByteBuffer.allocate((int) Math.min(fileLength, bufferSize));
    }

