    @Test
    public void testInvalidThriftInsert() throws IOException, TException
    {

        long timestamp = System.currentTimeMillis();
        ColumnPath cp = new ColumnPath(CF_INDEXED);
        ColumnParent par = new ColumnParent(CF_INDEXED);
        cp.column = ByteBufferUtil.bytes(INDEXED_COLUMN);

        // test we can insert if the index validates the expression:
        ByteBuffer key = ByteBufferUtil.bytes("valid");
        server.insert(key, par, new Column(key).setValue(ByteBufferUtil.bytes("valid")).setTimestamp(timestamp), ConsistencyLevel.ONE);

        // test we can't insert if the index doesn't validate the key:
        try
        {
            key = ByteBufferUtil.bytes("invalid");
            server.insert(key, par, new Column(key).setValue(ByteBufferUtil.bytes("valid")).setTimestamp(timestamp), ConsistencyLevel.ONE);
            fail("Query should have been invalid!");
        }
        catch (Exception e)
        {
            assertTrue(e instanceof org.apache.cassandra.thrift.InvalidRequestException);
        }

        // test we can't insert if the index doesn't validate the columns:
        try
        {
            key = ByteBufferUtil.bytes("valid");
            server.insert(key, par, new Column(key).setValue(ByteBufferUtil.bytes("invalid")).setTimestamp(timestamp), ConsistencyLevel.ONE);
            fail("Query should have been invalid!");
        }
        catch (Exception e)
        {
            assertTrue(e instanceof org.apache.cassandra.thrift.InvalidRequestException);
        }
    }

