        // Map of node ids to dc and rack - must be contiguous with an entry nodeId 1 to nodeCount
        public Builder<I, C> withNodeIdTopology(Map<Integer, NetworkTopology.DcAndRack> nodeIdTopology)
        {
            if (nodeIdTopology.isEmpty())
                throw new IllegalStateException("Topology is empty. It must have an entry for every nodeId.");

            IntStream.rangeClosed(1, nodeIdTopology.size()).forEach(nodeId -> {
                if (nodeIdTopology.get(nodeId) == null)
                    throw new IllegalStateException("Topology is missing entry for nodeId " + nodeId);
            });

            if (nodeCount != nodeIdTopology.size())
            {
                nodeCount = nodeIdTopology.size();
                logger.info("Adjusting node count to {} for supplied network topology", nodeCount);
            }

            this.nodeIdTopology = new HashMap<>(nodeIdTopology);

            return this;
        }

