    private static double boundDouble(long min, long max, double r)
    {
        if ((r >= min) && (r <= max))
            return r;
        if (r < min)
            return min;
        if (r > max)
            return max;
        throw new IllegalStateException();
    }

