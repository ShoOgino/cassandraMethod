    public void closeIfFinished() throws IOException
    {
        if (files.isEmpty())
        {
            // wait for bloom filters and row indexes to finish building
            List<SSTableReader> sstables = new ArrayList<SSTableReader>(buildFutures.size());
            for (Future<SSTableReader> future : buildFutures)
            {
                try
                {
                    SSTableReader sstable = future.get();
                    cfs.addSSTable(sstable);
                    sstables.add(sstable);
                }
                catch (InterruptedException e)
                {
                    throw new AssertionError(e);
                }
                catch (ExecutionException e)
                {
                    throw new RuntimeException(e);
                }
            }

            // build secondary indexes
            if (cfs != null && !cfs.getIndexedColumns().isEmpty())
                cfs.buildSecondaryIndexes(sstables, cfs.getIndexedColumns());

            // send reply to source that we're done
            StreamReply reply = new StreamReply("", getSessionId(), StreamReply.Status.SESSION_FINISHED);
            logger.info("Finished streaming session {} from {}", getSessionId(), getHost());
            MessagingService.instance.sendOneWay(reply.createMessage(), getHost());

            if (callback != null)
                callback.run();
            sessions.remove(context);
        }
    }

