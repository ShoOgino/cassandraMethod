        public PartitionUpdate deserialize(DataInputPlus in, int version, SerializationHelper.Flag flag, ByteBuffer key) throws IOException
        {
            if (version >= MessagingService.VERSION_30)
            {
                assert key == null; // key is only there for the old format
                return deserialize30(in, version, flag);
            }
            else
            {
                assert key != null;
                CFMetaData metadata = deserializeMetadata(in, version);
                DecoratedKey dk = metadata.decorateKey(key);
                return deserializePre30(in, version, flag, metadata, dk);
            }
        }

