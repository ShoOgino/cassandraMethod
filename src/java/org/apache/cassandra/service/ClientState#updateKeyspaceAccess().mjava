    /**
     * Called when the keyspace or user have changed.
     */
    private void updateKeyspaceAccess()
    {
        if (user.get() == null)
            // user is not logged in
            keyspaceAccess.set(null);
        else if (user.get().isSuper)
            // super user
            keyspaceAccess.set(AccessLevel.FULL);
        else if (keyspace.get() != null)
        {
            // lookup the access level for the user in the current keyspace
            KSMetaData ksm = DatabaseDescriptor.getTableDefinition(keyspace.get());
            keyspaceAccess.set(user.get().levelFor(ksm.usersAccess, ksm.groupsAccess));
        }
        else
            // user is logged in, but no keyspace is set
            keyspaceAccess.set(null);
    }

