    private long sizeOfComplexColumn(int idx, ColumnData data, boolean hasComplexDeletion, SerializationHeader header, LivenessInfo rowLiveness, boolean useSparse)
    {
        long size = 0;
        Iterator<Cell> cells = data == null ? null : data.cells();
        DeletionTime deletion = data == null ? DeletionTime.LIVE : data.complexDeletion();
        if (useSparse)
        {
            assert hasComplexDeletion || deletion.isLive();
            if (cells == null && deletion.isLive())
                return size;

            size += TypeSizes.sizeof((short)idx);
        }

        if (hasComplexDeletion)
            size += UnfilteredRowIteratorSerializer.delTimeSerializedSize(deletion, header);

        if (cells != null)
            while (cells.hasNext())
                size += sizeOfCell(cells.next(), header, rowLiveness);

        return size + sizeOfCell(null, header, rowLiveness);
    }

