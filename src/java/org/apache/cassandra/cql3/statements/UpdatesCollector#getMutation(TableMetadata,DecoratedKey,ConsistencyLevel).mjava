    private Mutation getMutation(TableMetadata metadata, DecoratedKey dk, ConsistencyLevel consistency)
    {
        String ksName = metadata.keyspace;
        IMutation mutation = keyspaceMap(ksName).get(dk.getKey());
        if (mutation == null)
        {
            Mutation mut = new Mutation(ksName, dk);
            mutation = metadata.isCounter() ? new CounterMutation(mut, consistency) : mut;
            keyspaceMap(ksName).put(dk.getKey(), mutation);
            return mut;
        }
        return metadata.isCounter() ? ((CounterMutation) mutation).getMutation() : (Mutation) mutation;
    }

