    public IColumn diff(IColumn columnNew)
    {
        IColumn columnDiff = new SuperColumn(columnNew.name(), ((SuperColumn)columnNew).getComparator());
        if (columnNew.getMarkedForDeleteAt() > getMarkedForDeleteAt())
        {
            ((SuperColumn)columnDiff).delete(columnNew.getLocalDeletionTime(), columnNew.getMarkedForDeleteAt());
        }

        // (don't need to worry about columnNew containing subColumns that are shadowed by
        // the delete tombstone, since columnNew was generated by CF.resolve, which
        // takes care of those for us.)
        for (IColumn subColumn : columnNew.getSubColumns())
        {
            IColumn columnInternal = columns.getColumn(subColumn.name());
            if(columnInternal == null )
            {
                columnDiff.addColumn(subColumn);
            }
            else
            {
                IColumn subColumnDiff = columnInternal.diff(subColumn);
                if(subColumnDiff != null)
                {
                    columnDiff.addColumn(subColumnDiff);
                }
            }
        }

        if (!columnDiff.getSubColumns().isEmpty() || columnNew.isMarkedForDelete())
            return columnDiff;
        else
            return null;
    }

