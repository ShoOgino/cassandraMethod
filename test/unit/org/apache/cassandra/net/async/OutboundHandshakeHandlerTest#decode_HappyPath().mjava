    @Test
    public void decode_HappyPath() throws Exception
    {
        buf = new SecondHandshakeMessage(MESSAGING_VERSION).encode(PooledByteBufAllocator.DEFAULT);
        channel.writeInbound(buf);
        Assert.assertEquals(1, channel.outboundMessages().size());
        Assert.assertTrue(channel.isOpen());
        Assert.assertTrue(channel.releaseOutbound()); // throw away any responses from decode()

        Assert.assertEquals(MESSAGING_VERSION, callbackHandler.result.negotiatedMessagingVersion);
        Assert.assertEquals(HandshakeResult.Outcome.SUCCESS, callbackHandler.result.outcome);
    }

