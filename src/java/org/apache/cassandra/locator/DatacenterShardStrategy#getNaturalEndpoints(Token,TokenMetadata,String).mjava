    public ArrayList<InetAddress> getNaturalEndpoints(Token searchToken, TokenMetadata metadata, String table)
    {
        ArrayList<InetAddress> endpoints = new ArrayList<InetAddress>();

        if (metadata.sortedTokens().isEmpty())
            return endpoints;

        for (String dc : dcTokens.keySet())
        {
            int replicas = getReplicationFactor(dc, table);
            List<Token> tokens = dcTokens.get(dc);
            boolean bOtherRack = false;
            // Add the node at the index by default
            Iterator<Token> iter = TokenMetadata.ringIterator(tokens, searchToken);
            InetAddress initialDCHost = metadata.getEndpoint(iter.next());
            assert initialDCHost != null;
            endpoints.add(initialDCHost);

            while (endpoints.size() < replicas && iter.hasNext())
            {
                Token t = iter.next();
                InetAddress endPointOfInterest = metadata.getEndpoint(t);
                if (endpoints.size() < replicas - 1)
                {
                    endpoints.add(endPointOfInterest);
                    continue;
                }

                // Now try to find one on a different rack
                if (!bOtherRack)
                {
                    if (!snitch.getRack(initialDCHost).equals(snitch.getRack(endPointOfInterest)))
                    {
                        endpoints.add(metadata.getEndpoint(t));
                        bOtherRack = true;
                    }
                }
                // If both already found exit loop.
                if (bOtherRack)
                    break;
            }

            /*
            * If we found N number of nodes we are good. This loop will just
            * exit. Otherwise just loop through the list and add until we
            * have N nodes.
            */
            if (endpoints.size() < replicas)
            {
                iter = TokenMetadata.ringIterator(tokens, searchToken);
                while (endpoints.size() < replicas && iter.hasNext())
                {
                    Token t = iter.next();
                    if (!endpoints.contains(metadata.getEndpoint(t)))
                    	endpoints.add(metadata.getEndpoint(t));
                }
            }
        }

        return endpoints;
    }

