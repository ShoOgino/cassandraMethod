    @Test
    public void failHandshake()
    {
        ChannelPromise future = channel.newPromise();
        handler.setHandshakeTimeout(future);
        Assert.assertFalse(future.isCancelled());
        Assert.assertTrue(channel.isOpen());
        handler.failHandshake(channel.pipeline().firstContext());
        Assert.assertSame(State.HANDSHAKE_FAIL, handler.getState());
        Assert.assertTrue(future.isCancelled());
        Assert.assertFalse(channel.isOpen());
    }

