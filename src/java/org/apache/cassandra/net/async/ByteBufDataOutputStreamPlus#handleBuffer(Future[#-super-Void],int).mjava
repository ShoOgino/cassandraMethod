    /**
     * Handles the result of publishing a buffer to the channel.
     *
     * Note: this will be executed on the event loop.
     */
    private void handleBuffer(Future<? super Void> future, int bytesWritten)
    {
        channelRateLimiter.release(bytesWritten);

        if (!future.isSuccess() && channel.isOpen())
            session.onError(future.cause());
    }

