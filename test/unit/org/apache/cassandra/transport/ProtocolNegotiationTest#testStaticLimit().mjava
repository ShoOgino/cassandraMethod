    @Test
    public void testStaticLimit() throws Throwable
    {
        try
        {
            reinitializeNetwork();
            // No limit enforced to start
            assertEquals(Integer.MIN_VALUE, DatabaseDescriptor.getNativeProtocolMaxVersionOverride());
            testConnection(null, ProtocolVersion.V4);

            // Update DatabaseDescriptor, then re-initialise the server to force it to read it
            setStaticLimitInConfig(ProtocolVersion.V3.toInt());
            reinitializeNetwork();
            assertEquals(3, DatabaseDescriptor.getNativeProtocolMaxVersionOverride());
            testConnection(ProtocolVersion.V4, ProtocolVersion.V3);
            testConnection(ProtocolVersion.V3, ProtocolVersion.V3);
            testConnection(null, ProtocolVersion.V3);
        } finally {
            setStaticLimitInConfig(null);
        }
    }

