    @Test
    public void testUpdateNotPresent() throws UnknownHostException
    {
        byte[] context = new byte[stepLength * 3];

        for (int i = 0; i < 3; i++)
        {
            cc.writeElementAtStepOffset(
                context,
                i,
                FBUtilities.toByteArray(i * 2),
                1L,
                1L);
        }

        context = cc.update(context, InetAddress.getByAddress(FBUtilities.toByteArray(3)), 328L);

        assert context.length == stepLength * 4;
        int offset = 2 * stepLength;
        assert   1L == FBUtilities.byteArrayToLong(context, offset + idLength);
        assert 328L == FBUtilities.byteArrayToLong(context, offset + idLength + clockLength);
        for (int i = 1; i < 2; i++)
        {
            offset = i * stepLength;
            assert 2 * i == FBUtilities.byteArrayToInt(context,  offset);
            assert    1L == FBUtilities.byteArrayToLong(context, offset + idLength);
            assert    1L == FBUtilities.byteArrayToLong(context, offset + idLength + clockLength);
        }
        offset = 3 * stepLength;
        assert  4 == FBUtilities.byteArrayToInt(context,  offset);
        assert 1L == FBUtilities.byteArrayToLong(context, offset + idLength);
        assert 1L == FBUtilities.byteArrayToLong(context, offset + idLength + clockLength);
    }

