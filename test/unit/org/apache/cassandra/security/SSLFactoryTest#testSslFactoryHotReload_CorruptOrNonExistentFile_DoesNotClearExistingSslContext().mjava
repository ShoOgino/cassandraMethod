    @Test
    public void testSslFactoryHotReload_CorruptOrNonExistentFile_DoesNotClearExistingSslContext() throws IOException,
                                                                                                         InterruptedException
    {
        try
        {
            addKeystoreOptions(encryptionOptions);

            File testKeystoreFile = new File(encryptionOptions.keystore + ".test");
            FileUtils.copyFile(new File(encryptionOptions.keystore),testKeystoreFile);
            encryptionOptions.keystore = testKeystoreFile.getPath();

            EncryptionOptions options = new ServerEncryptionOptions(encryptionOptions);
            options.enabled = true;

            SSLFactory.initHotReloading((ServerEncryptionOptions) options, options, true);
            SslContext oldCtx = SSLFactory.getOrCreateSslContext(options, true, SSLFactory.SocketType.CLIENT, OpenSsl
                                                                                                          .isAvailable());
            SSLFactory.checkCertFilesForHotReloading((ServerEncryptionOptions) options, options);

            testKeystoreFile.setLastModified(System.currentTimeMillis() + 15000);
            FileUtils.forceDelete(testKeystoreFile);

            SSLFactory.checkCertFilesForHotReloading((ServerEncryptionOptions) options, options);;
            SslContext newCtx = SSLFactory.getOrCreateSslContext(options, true, SSLFactory.SocketType.CLIENT, OpenSsl
                                                                                                          .isAvailable());

            Assert.assertSame(oldCtx, newCtx);
        }
        catch (Exception e)
        {
            throw e;
        }
        finally
        {
            DatabaseDescriptor.loadConfig();
            FileUtils.deleteQuietly(new File(encryptionOptions.keystore + ".test"));
        }
    }

