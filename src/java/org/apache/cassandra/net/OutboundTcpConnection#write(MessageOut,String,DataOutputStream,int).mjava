    public static void write(MessageOut message, String id, DataOutputStream out, int version) throws IOException
    {
        out.writeInt(MessagingService.PROTOCOL_MAGIC);
        if (version < MessagingService.VERSION_12)
            writeHeader(out, version, false);
        // 0.8 included a total message size int.  1.0 doesn't need it but expects it to be there.
        if (version <  MessagingService.VERSION_12)
            out.writeInt(-1);

        out.writeUTF(id);
        message.serialize(out, version);
    }

