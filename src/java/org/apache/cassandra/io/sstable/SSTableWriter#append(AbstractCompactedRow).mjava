    public RowIndexEntry append(AbstractCompactedRow row)
    {
        long currentPosition = beforeAppend(row.key);
        try
        {
            ByteBufferUtil.writeWithShortLength(row.key.key, dataFile.stream);
            long dataStart = dataFile.getFilePointer();
            long dataSize = row.write(dataFile.stream);
            assert dataSize == dataFile.getFilePointer() - (dataStart + 8)
                   : "incorrect row data size " + dataSize + " written to " + dataFile.getPath() + "; correct is " + (dataFile.getFilePointer() - (dataStart + 8));
        }
        catch (IOException e)
        {
            throw new FSWriteError(e, dataFile.getPath());
        }
        sstableMetadataCollector.update(dataFile.getFilePointer() - currentPosition, row.columnStats());
        return afterAppend(row.key, currentPosition, row.deletionInfo().getTopLevelDeletion(), row.index());
    }

