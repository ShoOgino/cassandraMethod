        public boolean shouldReplay(ReplayPosition position)
        {
            // replay ranges are start exclusive, end inclusive
            Map.Entry<ReplayPosition, ReplayPosition> range = persisted.lowerEntry(position);
            return range == null || position.compareTo(range.getValue()) > 0;
        }

