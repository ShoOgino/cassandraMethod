    /**
     * write endpoints may be different from read endpoints, because read endpoints only need care about the
     * "natural" nodes for a token, but write endpoints also need to account for nodes that are bootstrapping
     * into the ring, and write data there too so that they stay up to date during the bootstrap process.
     * Thus, this method may return more nodes than the Replication Factor.
     *
     * Only ReplicationStrategy should care about this method (higher level users should only ask for Hinted).
     */
    protected EndPoint[] getWriteStorageEndPoints(Token token, EndPoint[] naturalEndpoints)
    {
        Map<Token, EndPoint> tokenToEndPointMap = tokenMetadata_.cloneTokenEndPointMap();
        Map<Token, EndPoint> bootstrapTokensToEndpointMap = tokenMetadata_.cloneBootstrapNodes();
        ArrayList<EndPoint> list = new ArrayList<EndPoint>(Arrays.asList(naturalEndpoints));
        for (Token t : bootstrapTokensToEndpointMap.keySet())
        {
            EndPoint ep = bootstrapTokensToEndpointMap.get(t);
            tokenToEndPointMap.put(t, ep);
            try
            {
                for (Range r : getRangeMap(tokenToEndPointMap).get(ep))
                {
                    if (r.contains(token))
                    {
                        list.add(ep);
                        break;
                    }
                }
            }
            finally
            {
                tokenToEndPointMap.remove(t);
            }
        }
        return retrofitPorts(list).toArray(new EndPoint[list.size()]);
    }

