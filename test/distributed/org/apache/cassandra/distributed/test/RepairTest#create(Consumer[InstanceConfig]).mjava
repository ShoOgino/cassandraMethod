    private Cluster create(Consumer<InstanceConfig> configModifier) throws IOException
    {
        configModifier = configModifier.andThen(
            config -> config.set("hinted_handoff_enabled", false)
                            .set("commitlog_sync_batch_window_in_ms", 5)
                            .with(NETWORK)
                            .with(GOSSIP)
        );

        Cluster cluster = init(Cluster.build(3).withConfig(configModifier).start());
        try
        {
            cluster.schemaChange(withKeyspace("CREATE TABLE %s.test (k text, c1 text, c2 text, PRIMARY KEY (k));"));

            insert(cluster,    0, 1000, 1, 2, 3);
            flush(cluster, 1);
            insert(cluster, 1000, 1001, 1, 2);
            insert(cluster, 1001, 2001, 1, 2, 3);
            flush(cluster, 1, 2, 3);

            verify(cluster,    0, 1000, 1, 2, 3);
            verify(cluster, 1000, 1001, 1, 2);
            verify(cluster, 1001, 2001, 1, 2, 3);
            return cluster;
        }
        catch (Throwable t)
        {
            cluster.close();
            throw t;
        }
    }

