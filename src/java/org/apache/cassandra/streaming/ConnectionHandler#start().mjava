    /**
     * Start incoming/outgoing messaging threads.
     */
    public void start() throws IOException
    {
        SocketChannel channel = socket.getChannel();
        ReadableByteChannel in = channel;
        WritableByteChannel out = channel;
        // socket channel is null when encrypted(SSL)
        if (channel == null)
        {
            in = Channels.newChannel(socket.getInputStream());
            out = Channels.newChannel(socket.getOutputStream());
        }

        incoming = new IncomingMessageHandler(session, protocolVersion, in);
        outgoing = new OutgoingMessageHandler(session, protocolVersion, out);

        // ready to send/receive files
        new Thread(incoming, "STREAM-IN-" + session.peer).start();
        new Thread(outgoing, "STREAM-OUT-" + session.peer).start();
    }

