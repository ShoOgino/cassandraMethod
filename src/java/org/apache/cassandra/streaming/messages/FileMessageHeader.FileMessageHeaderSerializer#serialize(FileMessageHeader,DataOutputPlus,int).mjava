        public CompressionInfo serialize(FileMessageHeader header, DataOutputPlus out, int version) throws IOException
        {
            header.tableId.serialize(out);
            CompactEndpointSerializationHelper.streamingInstance.serialize(header.sender, out, version);
            UUIDSerializer.serializer.serialize(header.planId, out, version);
            out.writeInt(header.sessionIndex);
            out.writeInt(header.sequenceNumber);
            out.writeUTF(header.version.toString());
            out.writeUTF(header.format.name);

            out.writeLong(header.estimatedKeys);
            out.writeInt(header.sections.size());
            for (Pair<Long, Long> section : header.sections)
            {
                out.writeLong(section.left);
                out.writeLong(section.right);
            }
            // construct CompressionInfo here to avoid holding large number of Chunks on heap.
            CompressionInfo compressionInfo = null;
            if (header.compressionMetadata != null)
                compressionInfo = new CompressionInfo(header.compressionMetadata.getChunksForSections(header.sections), header.compressionMetadata.parameters);
            CompressionInfo.serializer.serialize(compressionInfo, out, version);
            out.writeLong(header.repairedAt);
            out.writeBoolean(header.pendingRepair != null);
            if (header.pendingRepair != null)
            {
                UUIDSerializer.serializer.serialize(header.pendingRepair, out, version);
            }
            out.writeInt(header.sstableLevel);

            SerializationHeader.serializer.serialize(header.version, header.header, out);
            return compressionInfo;
        }

