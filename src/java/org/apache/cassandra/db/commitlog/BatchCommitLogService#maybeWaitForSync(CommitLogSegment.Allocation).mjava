    protected void maybeWaitForSync(CommitLogSegment.Allocation alloc)
    {
        // wait until record has been safely persisted to disk
        pending.incrementAndGet();
        haveWork.release();
        alloc.awaitDiskSync();
        pending.decrementAndGet();
    }

