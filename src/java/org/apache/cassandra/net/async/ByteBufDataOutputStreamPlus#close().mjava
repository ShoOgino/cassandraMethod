    /**
     * {@inheritDoc}
     *
     * Flush any last buffered (if the channel is open), and release any buffers. *Not* responsible for closing
     * the netty channel as we might use it again for transferring more files.
     *
     * Note: should be called on the producer thread, not the netty event loop.
     */
    @Override
    public void close() throws IOException
    {
        doFlush(0);
        if (currentBuf.refCnt() > 0)
            currentBuf.release();
        currentBuf = null;
        buffer = null;
    }

