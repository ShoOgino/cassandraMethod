    static Multimap<InetAddress, Range<Token>> getWorkMap(Multimap<Range<Token>, InetAddress> rangesWithSourceTarget, IFailureDetector failureDetector)
    {
        /*
         * Map whose key is the source node and the value is a map whose key is the
         * target and value is the list of ranges to be sent to it.
        */
        Multimap<InetAddress, Range<Token>> sources = ArrayListMultimap.create();

        // TODO look for contiguous ranges and map them to the same source
        for (Range<Token> range : rangesWithSourceTarget.keySet())
        {
            for (InetAddress source : rangesWithSourceTarget.get(range))
            {
                // ignore the local IP...
                if (failureDetector.isAlive(source) && !source.equals(FBUtilities.getBroadcastAddress()))
                {
                    sources.put(source, range);
                    break;
                }
            }
        }
        return sources;
    }

