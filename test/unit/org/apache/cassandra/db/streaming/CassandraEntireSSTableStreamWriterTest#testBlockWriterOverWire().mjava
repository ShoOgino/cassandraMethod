    @Test
    public void testBlockWriterOverWire() throws IOException
    {
        StreamSession session = setupStreamingSessionForTest();

        CassandraEntireSSTableStreamWriter writer = new CassandraEntireSSTableStreamWriter(sstable, session, CassandraOutgoingFile.getComponentManifest(sstable));

        EmbeddedChannel channel = new EmbeddedChannel();
        ByteBufDataOutputStreamPlus out = ByteBufDataOutputStreamPlus.create(session, channel, 1024 * 1024);
        writer.write(out);

        Queue msgs = channel.outboundMessages();

        assertTrue(msgs.peek() instanceof DefaultFileRegion);
    }

