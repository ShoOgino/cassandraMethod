    private void setupStreamingPipeline(ChannelHandlerContext ctx, int protocolVersion)
    {
        ChannelPipeline pipeline = ctx.pipeline();
        InetSocketAddress address = (InetSocketAddress) ctx.channel().remoteAddress();
        pipeline.addLast(NettyFactory.instance.streamingGroup, "streamInbound", new StreamingInboundHandler(InetAddressAndPort.getByAddressOverrideDefaults(address.getAddress(), address.getPort()), protocolVersion, null));
        pipeline.remove(this);

        // pass a custom recv ByteBuf allocator to the channel. the default recv ByteBuf size is 1k, but in streaming we're
        // dealing with large bulk blocks of data, let's default to larger sizes
        ctx.channel().config().setRecvByteBufAllocator(new AdaptiveRecvByteBufAllocator(1 << 8, 1 << 13, 1 << 16));
    }

