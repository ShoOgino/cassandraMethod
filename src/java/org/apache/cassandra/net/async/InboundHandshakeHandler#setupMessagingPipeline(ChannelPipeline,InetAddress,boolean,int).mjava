    @VisibleForTesting
    void setupMessagingPipeline(ChannelPipeline pipeline, InetAddress peer, boolean compressed, int messagingVersion)
    {
        if (compressed)
            pipeline.addLast(NettyFactory.INBOUND_COMPRESSOR_HANDLER_NAME, NettyFactory.createLz4Decoder(messagingVersion));

        pipeline.addLast("messageInHandler", new MessageInHandler(peer, messagingVersion));
        pipeline.remove(this);
    }

