    private void testReadImpl(int numIterations, int skipIterations, int bufferSize) throws IOException
    {
        final File f = File.createTempFile("testReadFully", "1");
        final String expected = "The quick brown fox jumps over the lazy dog";

        SequentialWriter writer = SequentialWriter.open(f);
        for (int i = 0; i < numIterations; i++)
            writer.write(expected.getBytes());
        writer.finish();

        assert f.exists();

        ChannelProxy channel = new ChannelProxy(f);
        RandomAccessReader reader = RandomAccessReader.open(channel, bufferSize, -1L);
        assertEquals(f.getAbsolutePath(), reader.getPath());
        assertEquals(expected.length() * numIterations, reader.length());

        if (skipIterations > 0)
        {
            reader.seek(skipIterations * expected.length());
        }

        byte[] b = new byte[expected.length()];
        int n = numIterations - skipIterations;
        for (int i = 0; i < n; i++)
        {
            reader.readFully(b);
            assertEquals(expected, new String(b));
        }

        assertTrue(reader.isEOF());
        assertEquals(0, reader.bytesRemaining());

        reader.close();
        channel.close();
    }

