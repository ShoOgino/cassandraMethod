        /**
         * Creates the table according to schema statement
         *
         * @param keyspace name of the keyspace where table should be created
         */
        private TableMetadata createTable(String keyspace)
        {
            KeyspaceMetadata ksm = Schema.instance.getKeyspaceMetadata(keyspace);

            TableMetadata tableMetadata = ksm.tables.getNullable(schemaStatement.columnFamily());

            if (tableMetadata != null)
                return tableMetadata;

            CreateTableStatement statement = (CreateTableStatement) schemaStatement.prepare(ksm.types).statement;
            statement.validate(ClientState.forInternalCalls());

            TableMetadata.Builder builder = statement.builder();
            if (partitioner != null)
                builder.partitioner(partitioner);
            TableMetadata metadata = builder.build();

            Schema.instance.load(ksm.withSwapped(ksm.tables.with(metadata)));
            return metadata;
        }

