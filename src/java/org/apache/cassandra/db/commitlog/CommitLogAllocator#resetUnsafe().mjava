    /**
     * Resets all the segments, for testing purposes. DO NOT USE THIS OUTSIDE OF TESTS.
     */
    public void resetUnsafe()
    {
        logger.debug("Closing and clearing existing commit log segments...");

        while (StorageService.tasks.getActiveCount() > 0 || !queue.isEmpty())
            Thread.yield();

        Uninterruptibles.sleepUninterruptibly(10, TimeUnit.MILLISECONDS);

        for (CommitLogSegment segment : Iterables.concat(activeSegments, availableSegments))
            segment.close();

        activeSegments.clear();
        availableSegments.clear();
    }

