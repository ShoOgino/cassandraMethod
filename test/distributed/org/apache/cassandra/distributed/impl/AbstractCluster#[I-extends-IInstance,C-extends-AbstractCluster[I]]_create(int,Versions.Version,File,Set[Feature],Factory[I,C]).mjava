    protected static <I extends IInstance, C extends AbstractCluster<I>> C
    create(int nodeCount, Versions.Version version, File root, Set<Feature> features, Factory<I, C> factory)
    {
        root.mkdirs();
        setupLogging(root);

        ClassLoader sharedClassLoader = Thread.currentThread().getContextClassLoader();

        List<InstanceConfig> configs = new ArrayList<>();
        long token = Long.MIN_VALUE + 1, increment = 2 * (Long.MAX_VALUE / nodeCount);
        for (int i = 0 ; i < nodeCount ; ++i)
        {
            InstanceConfig config = InstanceConfig.generate(i + 1, root, String.valueOf(token));
            configs.add(config);
            token += increment;
        }

        C cluster = factory.newCluster(root, version, configs, features, sharedClassLoader);
        return cluster;
    }

