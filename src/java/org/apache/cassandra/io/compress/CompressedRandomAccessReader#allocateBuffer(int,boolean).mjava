    protected ByteBuffer allocateBuffer(int bufferSize, boolean useDirect)
    {
        assert Integer.bitCount(bufferSize) == 1;
        return useMmap && useDirect
                ? ByteBuffer.allocateDirect(bufferSize)
                : ByteBuffer.allocate(bufferSize);
    }

