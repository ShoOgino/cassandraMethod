    /*
     * Take a snapshot of the entire set of column families.
    */
    public void snapshot( String clientSuppliedName ) throws IOException
    {
    	String snapshotDirectory = DatabaseDescriptor.getSnapshotDirectory();
    	File snapshotDir = new File(snapshotDirectory);
    	if( !snapshotDir.exists() )
    		snapshotDir.mkdir();

    	String currentSnapshotDir = null;
    	if( clientSuppliedName != null && !clientSuppliedName.equals("") )
    		currentSnapshotDir = snapshotDirectory + System.getProperty("file.separator") + System.currentTimeMillis() + "-" + clientSuppliedName; 
    	else
    		currentSnapshotDir = snapshotDirectory + System.getProperty("file.separator") + System.currentTimeMillis();

    	/* First take a snapshot of the commit logs */
    	CommitLog.open(table_).snapshot( currentSnapshotDir );
    	/* force roll over the commit log */
    	CommitLog.open(table_).setForcedRollOver();
    	/* Now take a snapshot of all columnfamily stores */
        Set<String> columnFamilies = tableMetadata_.getColumnFamilies();
        for ( String columnFamily : columnFamilies )
        {
            ColumnFamilyStore cfStore = columnFamilyStores_.get( columnFamily );
            if ( cfStore != null )
                cfStore.snapshot( currentSnapshotDir );
        }
    }

