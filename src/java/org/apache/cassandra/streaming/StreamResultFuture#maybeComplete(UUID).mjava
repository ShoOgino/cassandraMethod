    private synchronized void maybeComplete(UUID sessionId)
    {
        ongoingSessions.remove(sessionId);
        if (ongoingSessions.isEmpty())
        {
            StreamState finalState = getCurrentState();
            if (finalState.hasFailedSession())
                setException(new StreamException(finalState, "Stream failed"));
            else
                set(finalState);
        }
    }

