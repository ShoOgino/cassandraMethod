        @Override
        public boolean test(Message<?> messageOut, InetAddressAndPort to)
        {
            try (DataOutputBuffer out = new DataOutputBuffer(1024))
            {
                int version = MessagingService.instance().versions.get(to);
                InetAddressAndPort from = broadcastAddressAndPort();
                Tracing.instance.traceOutgoingMessage(messageOut, to);
                Message.serializer.serialize(messageOut, out, version);
                deliver.accept(to, new MessageImpl(messageOut.verb().id, out.toByteArray(), messageOut.id(), version, from));
            }
            catch (IOException e)
            {
                throw new RuntimeException(e);
            }
            return false;
        }

