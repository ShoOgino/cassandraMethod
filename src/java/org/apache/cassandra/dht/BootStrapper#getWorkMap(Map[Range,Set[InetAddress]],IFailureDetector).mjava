    static Map<InetAddress, List<Range>> getWorkMap(Map<Range, Set<InetAddress>> rangesWithSourceTarget, IFailureDetector failureDetector)
    {
        /*
         * Map whose key is the source node and the value is a map whose key is the
         * target and value is the list of ranges to be sent to it.
        */
        Map<InetAddress, List<Range>> sources = new HashMap<InetAddress, List<Range>>();

        // TODO look for contiguous ranges and map them to the same source
        for (Range range : rangesWithSourceTarget.keySet())
        {
            for (InetAddress source : rangesWithSourceTarget.get(range))
            {
                if (failureDetector.isAlive(source))
                {
                    List<Range> ranges = sources.get(source);
                    if (ranges == null)
                    {
                        ranges = new ArrayList<Range>();
                        sources.put(source, ranges);
                    }
                    ranges.add(range);
                    break;
                }
            }
        }
        return sources;
    }

