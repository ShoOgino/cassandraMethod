    @Test
    public void testOutboundTcpConnectionCleansUp() throws Exception
    {
        MessagingService ms = MessagingService.instance();
        DatabaseDescriptor.setInternodeAuthenticator(ALLOW_NOTHING_AUTHENTICATOR);
        InetAddress address = InetAddress.getByName("127.0.0.250");
        OutboundTcpConnectionPool pool = new OutboundTcpConnectionPool(address, new MockBackPressureStrategy(null).newState(address));
        ms.connectionManagers.put(address, pool);
        pool.smallMessages.start();
        pool.smallMessages.enqueue(new MessageOut(MessagingService.Verb.GOSSIP_DIGEST_ACK), 0);
        pool.smallMessages.join();
        assertFalse(ms.connectionManagers.containsKey(address));
    }

