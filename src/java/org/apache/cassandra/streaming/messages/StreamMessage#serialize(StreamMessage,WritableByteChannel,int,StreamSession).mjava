    public static void serialize(StreamMessage message, WritableByteChannel out, int version, StreamSession session) throws IOException
    {
        ByteBuffer buff = ByteBuffer.allocate(1);
        // message type
        buff.put(message.type.type);
        buff.flip();
        while (buff.hasRemaining())
            out.write(buff);
        message.type.serializer.serialize(message, out, version, session);
    }

