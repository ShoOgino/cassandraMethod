    @Test
    public void testStreamSessionUsesCorrectRemoteIp_Succeeds() throws UnknownHostException
    {
        InetAddressAndPort localAddr = InetAddressAndPort.getByName("127.0.0.1:7000");
        InetAddressAndPort preferredAddr = InetAddressAndPort.getByName("127.0.0.2:7000");
        StreamSession streamSession = new StreamSession(StreamOperation.BOOTSTRAP, localAddr,
                          new DefaultConnectionFactory(), 0, UUID.randomUUID(), PreviewKind.ALL,
                          inetAddressAndPort -> preferredAddr);

        assertEquals(preferredAddr, streamSession.getMessageSender().getConnectionId().connectionAddress());
    }

