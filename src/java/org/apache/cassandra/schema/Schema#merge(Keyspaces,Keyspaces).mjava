    private synchronized void merge(Keyspaces before, Keyspaces after)
    {
        MapDifference<String, KeyspaceMetadata> keyspacesDiff = before.diff(after);

        // dropped keyspaces
        keyspacesDiff.entriesOnlyOnLeft().values().forEach(this::dropKeyspace);

        // new keyspaces
        keyspacesDiff.entriesOnlyOnRight().values().forEach(this::createKeyspace);

        // updated keyspaces
        keyspacesDiff.entriesDiffering().entrySet().forEach(diff -> alterKeyspace(diff.getValue().leftValue(), diff.getValue().rightValue()));
    }

