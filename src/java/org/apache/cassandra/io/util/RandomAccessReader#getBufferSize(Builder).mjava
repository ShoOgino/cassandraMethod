    protected int getBufferSize(Builder builder)
    {
        if (builder.limiter == null)
            return builder.bufferSize;

        // limit to ensure more accurate throttling
        return Math.min(MAX_THROTTLED_BUFFER_SIZE, builder.bufferSize);
    }

