    protected Directories.DataDirectory getWriteDirectory(long writeSize)
    {
        Directories.DataDirectory directory;
        directory = getDirectory();

        if (directory == null) // ok panic - write anywhere
            directory = getDirectories().getWriteableLocation(writeSize);

        if (directory == null)
            throw new RuntimeException(String.format("Insufficient disk space to write %s",
                                                     FBUtilities.prettyPrintMemory(writeSize)));

        return directory;
    }

