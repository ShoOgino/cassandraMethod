    public void runCacheRespectsTokenChangesTest(Class stratClass) throws Exception
    {
        // TODO DSS is asked to provide a total of 6 replicas, but we never give it 6 endpoints.
        // thus we are testing undefined behavior, at best.
        setup(stratClass);
        ArrayList<InetAddress> endpoints;

        endpoints = strategy.getNaturalEndpoints(searchToken, "Keyspace3");
        assert endpoints.size() == 2 : StringUtils.join(endpoints, ",");

        // test token addition
        tmd.updateNormalToken(new BigIntegerToken(String.valueOf(30)), InetAddress.getByName("127.0.0.3"));
        endpoints = strategy.getNaturalEndpoints(searchToken, "Keyspace3");
        assert endpoints.size() == 3 : StringUtils.join(endpoints, ",");

        // test token removal
        tmd.removeEndpoint(InetAddress.getByName("127.0.0.2"));
        endpoints = strategy.getNaturalEndpoints(searchToken, "Keyspace3");
        assert endpoints.size() == 2 : StringUtils.join(endpoints, ",");

        // test token change
        tmd.updateNormalToken(new BigIntegerToken(String.valueOf(30)), InetAddress.getByName("127.0.0.5"));
        endpoints = strategy.getNaturalEndpoints(searchToken, "Keyspace3");
        assert endpoints.size() == 2 : StringUtils.join(endpoints, ",");
        assert endpoints.contains(InetAddress.getByName("127.0.0.5"));
        assert !endpoints.contains(InetAddress.getByName("127.0.0.3"));
    }

