    private ByteBuffer readAndDigest(String partitionKey)
    {
        /*
         * In 2.2, this must be replaced by:
         *   ColumnFamily partition = getCurrentColumnFamilyStore().getColumnFamily(QueryFilter.getIdentityFilter(Util.dk(partitionKey), currentTable(), System.currentTimeMillis()));
         *   return ColumnFamily.digest(partition);
         */

        ReadCommand cmd = Util.cmd(getCurrentColumnFamilyStore(), partitionKey).build();
        ImmutableBTreePartition partition = Util.getOnlyPartitionUnfiltered(cmd);
        MessageDigest digest = FBUtilities.threadLocalMD5Digest();
        UnfilteredRowIterators.digest(cmd, partition.unfilteredIterator(), digest, MessagingService.VERSION_22);
        return ByteBuffer.wrap(digest.digest());
    }

