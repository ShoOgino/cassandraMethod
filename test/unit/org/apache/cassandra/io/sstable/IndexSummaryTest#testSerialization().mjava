    @Test
    public void testSerialization() throws IOException
    {
        Pair<List<DecoratedKey>, IndexSummary> random = generateRandomIndex(100, 1);
        ByteArrayOutputStream aos = new ByteArrayOutputStream();
        DataOutputStream dos = new DataOutputStream(aos);
        IndexSummary.serializer.serialize(random.right, dos);
        // write junk
        dos.writeUTF("JUNK");
        dos.writeUTF("JUNK");
        FileUtils.closeQuietly(dos);
        DataInputStream dis = new DataInputStream(new ByteArrayInputStream(aos.toByteArray()));
        IndexSummary is = IndexSummary.serializer.deserialize(dis, DatabaseDescriptor.getPartitioner());
        for (int i = 0; i < 100; i++)
            Assert.assertEquals(i, is.binarySearch(random.left.get(i)));
        // read the junk
        Assert.assertEquals(dis.readUTF(), "JUNK");
        Assert.assertEquals(dis.readUTF(), "JUNK");
        FileUtils.closeQuietly(dis);
    }

