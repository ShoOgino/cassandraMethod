    public static Map<ParameterType, Object> readParameters(DataInputPlus in, int version) throws IOException
    {
        int parameterCount = in.readInt();
        Map<ParameterType, Object> parameters;
        if (parameterCount == 0)
        {
            return Collections.emptyMap();
        }
        else
        {
            ImmutableMap.Builder<ParameterType, Object> builder = ImmutableMap.builder();
            for (int i = 0; i < parameterCount; i++)
            {
                String key = in.readUTF();
                ParameterType type = ParameterType.byName.get(key);
                if (type != null)
                {
                    byte[] value = new byte[in.readInt()];
                    in.readFully(value);
                    try (DataInputBuffer buffer = new DataInputBuffer(value))
                    {
                        builder.put(type, type.serializer.deserialize(buffer, version));
                    }
                }
                else
                {
                    in.skipBytes(in.readInt());
                }
            }
            return builder.build();
        }
    }

