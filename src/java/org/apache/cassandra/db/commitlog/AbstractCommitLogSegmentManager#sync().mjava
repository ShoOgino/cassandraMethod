    /**
     * Forces a disk flush on the commit log files that need it.  Blocking.
     */
    public void sync() throws IOException
    {
        CommitLogSegment current = allocatingFrom;
        for (CommitLogSegment segment : getActiveSegments())
        {
            // Do not sync segments that became active after sync started.
            if (segment.id > current.id)
                return;
            segment.sync();
        }
    }

