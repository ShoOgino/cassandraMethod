        NeighboursAndResult addValue(int point, int delta)
        {
            long key = wrap(point, 0);
            int index = Arrays.binarySearch(data, key);
            AddResult addResult;
            if (index < 0)
            {
                index = -index - 1;
                assert (index < data.length) : "No more space in array";

                if (unwrapPoint(data[index]) != point) //ok, someone else at this point, let's shift array and insert
                {
                    assert (data[data.length - 1] == EMPTY) : "No more space in array";

                    System.arraycopy(data, index, data, index + 1, data.length - index - 1);

                    data[index] = wrap(point, delta);
                    addResult = INSERTED;
                }
                else
                {
                    data[index] += delta;
                    addResult = ACCUMULATED;
                }
            }
            else
            {
                data[index] += delta;
                addResult = ACCUMULATED;
            }

            return new NeighboursAndResult(getPrevPoint(index), getNextPoint(index), addResult);
        }

