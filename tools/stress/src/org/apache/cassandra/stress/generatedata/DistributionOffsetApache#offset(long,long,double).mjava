    private long offset(long min, long delta, double val)
    {
        long r = (long) val;
        if (r < 0)
            r = 0;
        if (r > delta)
            r = delta;
        return min + r;
    }

