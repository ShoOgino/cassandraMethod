    public void testLog(ParameterizedClass compression, EncryptionContext encryptionContext) throws IOException, InterruptedException
    {
        DatabaseDescriptor.setCommitLogCompression(compression);
        DatabaseDescriptor.setEncryptionContext(encryptionContext);

        String originalDir = DatabaseDescriptor.getCommitLogLocation();
        try
        {
            DatabaseDescriptor.setCommitLogLocation(location);
            for (CommitLogSync sync : CommitLogSync.values())
            {
                DatabaseDescriptor.setCommitLogSync(sync);
                CommitLog commitLog = new CommitLog(CommitLogArchiver.disabled()).start();
                // Need to enable reserve segment creation as close to test start as possible to minimize race
                commitLog.segmentManager.enableReserveSegmentCreation();
                testLog(commitLog);
                assert !failed;
            }
        }
        finally
        {
            DatabaseDescriptor.setCommitLogLocation(originalDir);
        }
    }

