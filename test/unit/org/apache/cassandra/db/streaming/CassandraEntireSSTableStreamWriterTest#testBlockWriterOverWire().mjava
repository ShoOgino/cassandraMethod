    @Test
    public void testBlockWriterOverWire() throws IOException
    {
        StreamSession session = setupStreamingSessionForTest();

        CassandraEntireSSTableStreamWriter writer = new CassandraEntireSSTableStreamWriter(sstable, session, CassandraOutgoingFile.getComponentManifest(sstable));

        EmbeddedChannel channel = new EmbeddedChannel();
        AsyncStreamingOutputPlus out = new AsyncStreamingOutputPlus(channel);
        writer.write(out);

        Queue msgs = channel.outboundMessages();

        assertTrue(msgs.peek() instanceof DefaultFileRegion);
    }

