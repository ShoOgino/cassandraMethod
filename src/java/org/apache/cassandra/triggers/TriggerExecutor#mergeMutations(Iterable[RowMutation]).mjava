    private Collection<RowMutation> mergeMutations(Iterable<RowMutation> mutations)
    {
        Map<Pair<String, ByteBuffer>, RowMutation> groupedMutations = new HashMap<>();

        for (RowMutation mutation : mutations)
        {
            Pair<String, ByteBuffer> key = Pair.create(mutation.getKeyspaceName(), mutation.key());
            RowMutation current = groupedMutations.get(key);
            if (current == null)
            {
                // copy in case the mutation's modifications map is backed by an immutable Collections#singletonMap().
                groupedMutations.put(key, mutation.copy());
            }
            else
            {
                current.addAll(mutation);
            }
        }

        return groupedMutations.values();
    }

