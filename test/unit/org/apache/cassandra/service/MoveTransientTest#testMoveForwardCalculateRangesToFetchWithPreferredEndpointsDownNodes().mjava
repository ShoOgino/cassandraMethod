    @Test
    public void testMoveForwardCalculateRangesToFetchWithPreferredEndpointsDownNodes() throws Exception
    {
        downNodes.add(dAddress);
        boolean threw = false;
        try
        {
            testMoveForwardCalculateRangesToFetchWithPreferredEndpoints();
        }
        catch (IllegalStateException ise)
        {
            ise.printStackTrace();
            assertTrue(dAddress.toString(),
                       ise.getMessage().startsWith("A node required to move the data consistently is down:")
                       && ise.getMessage().contains(dAddress.toString()));
            threw = true;
        }
        assertTrue("Didn't throw for " + dAddress, threw);

        //Shouldn't throw because another full replica is available
        downNodes.clear();
        downNodes.add(cAddress);
        testMoveForwardBetweenCalculateRangesToFetchWithPreferredEndpoints();
    }

