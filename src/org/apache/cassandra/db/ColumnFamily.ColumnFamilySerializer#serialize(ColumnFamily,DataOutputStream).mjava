        /*
         * We are going to create indexes, and write out that information as well. The format
         * of the data serialized is as follows.
         *
         * 1) Without indexes:
         *  // written by the data
         * 	<boolean false (index is not present)>
         * 	<column family id>
         * 	<is marked for delete>
         * 	<total number of columns>
         * 	<columns data>

         * 	<boolean true (index is present)>
         *
         *  This part is written by the column indexer
         * 	<size of index in bytes>
         * 	<list of column names and their offsets relative to the first column>
         *
         *  <size of the cf in bytes>
         * 	<column family id>
         * 	<is marked for delete>
         * 	<total number of columns>
         * 	<columns data>
        */
        public void serialize(ColumnFamily columnFamily, DataOutputStream dos) throws IOException
        {
            Collection<IColumn> columns = columnFamily.getAllColumns();

            /* write the column family id */
            dos.writeUTF(columnFamily.name());
            /* write if this cf is marked for delete */
            dos.writeLong(columnFamily.getMarkedForDeleteAt());

            /* write the size is the number of columns */
            dos.writeInt(columns.size());

            /* write the column data */
            for ( IColumn column : columns )
            {
                columnFamily.getColumnSerializer().serialize(column, dos);
            }
        }

