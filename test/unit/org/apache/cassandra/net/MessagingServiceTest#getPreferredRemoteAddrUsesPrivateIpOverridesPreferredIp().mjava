    @Test
    public void getPreferredRemoteAddrUsesPrivateIpOverridesPreferredIp() throws UnknownHostException
    {
        MessagingService ms = MessagingService.instance();
        InetAddressAndPort local = InetAddressAndPort.getByNameOverrideDefaults("127.0.0.4", 7000);
        InetAddressAndPort remote = InetAddressAndPort.getByNameOverrideDefaults("127.0.0.105", 7000);
        InetAddressAndPort privateIp = InetAddressAndPort.getByName("127.0.0.6");

        OutboundMessagingPool pool = new OutboundMessagingPool(privateIp, local, null,
                                                               new MockBackPressureStrategy(null).newState(remote),
                                                               ALLOW_NOTHING_AUTHENTICATOR);
        ms.channelManagers.put(remote, pool);

        InetAddressAndPort preferredIp = InetAddressAndPort.getByName("127.0.0.16");
        SystemKeyspace.updatePreferredIP(remote, preferredIp);

        Assert.assertEquals(privateIp, ms.getPreferredRemoteAddr(remote));
    }

