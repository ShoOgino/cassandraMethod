    public void applyModels() throws IOException
    {
        String snapshotName = Table.getTimestampedSnapshotName(name);
        KSMetaData ksm = schema.getTableDefinition(name);

        // remove all cfs from the table instance.
        for (CFMetaData cfm : ksm.cfMetaData().values())
        {
            ColumnFamilyStore cfs = Table.open(ksm.name, schema).getColumnFamilyStore(cfm.cfName);
            schema.purge(cfm);
            if (!StorageService.instance.isClientMode())
            {
                cfs.snapshot(snapshotName);
                Table.open(ksm.name, schema).dropCf(cfm.cfId);
            }
        }

        // remove the table from the static instances.
        Table table = Table.clear(ksm.name, schema);
        assert table != null;
        // reset defs.
        schema.clearTableDefinition(ksm, newVersion);
    }

