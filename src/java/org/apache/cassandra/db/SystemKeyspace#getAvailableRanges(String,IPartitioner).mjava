    public static synchronized RangesAtEndpoint getAvailableRanges(String keyspace, IPartitioner partitioner)
    {
        String query = "SELECT * FROM system.%s WHERE keyspace_name=?";
        UntypedResultSet rs = executeInternal(format(query, AVAILABLE_RANGES_V2), keyspace);
        InetAddressAndPort endpoint = InetAddressAndPort.getLocalHost();
        RangesAtEndpoint.Builder builder = RangesAtEndpoint.builder(endpoint);
        for (UntypedResultSet.Row row : rs)
        {
            Optional.ofNullable(row.getSet("full_ranges", BytesType.instance))
                    .ifPresent(full_ranges -> full_ranges.stream()
                            .map(buf -> byteBufferToRange(buf, partitioner))
                            .forEach(range -> builder.add(fullReplica(endpoint, range))));
            Optional.ofNullable(row.getSet("transient_ranges", BytesType.instance))
                    .ifPresent(transient_ranges -> transient_ranges.stream()
                            .map(buf -> byteBufferToRange(buf, partitioner))
                            .forEach(range -> builder.add(transientReplica(endpoint, range))));
        }
        return builder.build();
    }

