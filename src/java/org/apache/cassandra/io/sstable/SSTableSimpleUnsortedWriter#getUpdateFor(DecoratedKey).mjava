    PartitionUpdate getUpdateFor(DecoratedKey key)
    {
        assert key != null;

        PartitionUpdate previous = buffer.get(key);
        if (previous == null)
        {
            previous = createPartitionUpdate(key);
            currentSize += PartitionUpdate.serializer.serializedSize(previous, formatType.info.getLatestVersion().correspondingMessagingVersion());
            previous.allowNewUpdates();
            buffer.put(key, previous);
        }
        return previous;
    }

