    /**
     * {@inheritDoc}
     *
     * Compress the incoming buffer and send the result downstream. The buffer parameter will not be used nor passed
     * to downstream components, and thus callers can safely free the buffer upon return.
     */
    @Override
    public void write(ByteBuffer buffer) throws IOException
    {
        ByteBuf compressed = serializer.serialize(compressor, buffer, StreamMessage.CURRENT_VERSION);

        // this is a blocking call - you have been warned
        limiter.acquire(compressed.readableBytes());

        ((ByteBufDataOutputStreamPlus)out).writeToChannel(compressed);
    }

