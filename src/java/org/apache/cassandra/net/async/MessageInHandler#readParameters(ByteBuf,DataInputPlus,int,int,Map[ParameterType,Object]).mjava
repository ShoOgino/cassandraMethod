    private static void readParameters(ByteBuf buf, DataInputPlus in, int messagingVersion, int parameterLength, Map<ParameterType, Object> parameters) throws IOException
    {
        // makes the assumption we have all the bytes required to read the headers
        final int endIndex = buf.readerIndex() + parameterLength;
        while (buf.readerIndex() < endIndex)
        {
            String key = in.readUTF();
            ParameterType parameterType = ParameterType.byName.get(key);
            long valueLength =  in.readUnsignedVInt();
            byte[] value = new byte[Ints.checkedCast(valueLength)];
            in.readFully(value);
            try (DataInputBuffer buffer = new DataInputBuffer(value))
            {
                parameters.put(parameterType, parameterType.serializer.deserialize(buffer, messagingVersion));
            }
        }
    }

