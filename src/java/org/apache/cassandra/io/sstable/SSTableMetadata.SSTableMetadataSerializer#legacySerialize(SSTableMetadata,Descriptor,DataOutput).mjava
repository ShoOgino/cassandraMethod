        /**
         * Used to serialize to an old version - needed to be able to update sstable level without a full compaction.
         *
         * @deprecated will be removed when it is assumed that the minimum upgrade-from-version is the version that this
         * patch made it into
         *
         * @param sstableStats
         * @param legacyDesc
         * @param dos
         * @throws IOException
         */
        @Deprecated
        public void legacySerialize(SSTableMetadata sstableStats, Descriptor legacyDesc, DataOutput dos) throws IOException
        {
            EstimatedHistogram.serializer.serialize(sstableStats.estimatedRowSize, dos);
            EstimatedHistogram.serializer.serialize(sstableStats.estimatedColumnCount, dos);
            if (legacyDesc.version.metadataIncludesReplayPosition)
                ReplayPosition.serializer.serialize(sstableStats.replayPosition, dos);
            if (legacyDesc.version.tracksMinTimestamp)
                dos.writeLong(sstableStats.minTimestamp);
            if (legacyDesc.version.tracksMaxTimestamp)
                dos.writeLong(sstableStats.maxTimestamp);
            if (legacyDesc.version.tracksMaxLocalDeletionTime)
                dos.writeInt(sstableStats.maxLocalDeletionTime);
            if (legacyDesc.version.hasCompressionRatio)
                dos.writeDouble(sstableStats.compressionRatio);
            if (legacyDesc.version.hasPartitioner)
                dos.writeUTF(sstableStats.partitioner);
            if (legacyDesc.version.hasAncestors)
            {
                dos.writeInt(sstableStats.ancestors.size());
                for (Integer g : sstableStats.ancestors)
                    dos.writeInt(g);
            }
            if (legacyDesc.version.tracksTombstones)
                StreamingHistogram.serializer.serialize(sstableStats.estimatedTombstoneDropTime, dos);

            dos.writeInt(sstableStats.sstableLevel);
        }

