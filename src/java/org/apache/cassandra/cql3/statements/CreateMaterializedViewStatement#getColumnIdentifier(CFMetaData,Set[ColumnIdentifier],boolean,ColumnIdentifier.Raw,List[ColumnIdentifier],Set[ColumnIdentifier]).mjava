    private static boolean getColumnIdentifier(CFMetaData cfm,
                                               Set<ColumnIdentifier> basePK,
                                               boolean hasNonPKColumn,
                                               ColumnIdentifier.Raw raw,
                                               List<ColumnIdentifier> columns,
                                               Set<ColumnIdentifier> allowedPKColumns)
    {
        ColumnIdentifier identifier = raw.prepare(cfm);

        boolean isPk = basePK.contains(identifier);
        if (!isPk && hasNonPKColumn)
        {
            throw new InvalidRequestException(String.format("Cannot include more than one non-primary key column '%s' in materialized view partition key", identifier));
        }
        if (!allowedPKColumns.contains(identifier))
        {
            throw new InvalidRequestException(String.format("Primary key column '%s' is required to be filtered by 'IS NOT NULL'", identifier));
        }

        columns.add(identifier);
        return !isPk;
    }

