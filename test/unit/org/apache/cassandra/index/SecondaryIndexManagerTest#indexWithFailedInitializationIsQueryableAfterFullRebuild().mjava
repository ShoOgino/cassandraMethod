    @Test
    public void indexWithFailedInitializationIsQueryableAfterFullRebuild() throws Throwable
    {
        createTable("CREATE TABLE %s (a int, b int, c int, PRIMARY KEY (a, b))");

        TestingIndex.shouldFailCreate = true;
        String indexName = createIndex(String.format("CREATE CUSTOM INDEX ON %%s(c) USING '%s'", TestingIndex.class.getName()));

        tryRebuild(indexName, true);
        TestingIndex.shouldFailCreate = false;

        // a successfull full rebuild should set the index as queryable
        ColumnFamilyStore cfs = getCurrentColumnFamilyStore();
        Index index = cfs.indexManager.getIndexByName(indexName);
        cfs.indexManager.rebuildIndexesBlocking(Collections.singleton(indexName));
        assertTrue(cfs.indexManager.isIndexQueryable(index));
    }

