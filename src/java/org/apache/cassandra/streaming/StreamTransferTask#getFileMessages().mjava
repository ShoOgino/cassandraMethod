    public synchronized Collection<OutgoingFileMessage> getFileMessages()
    {
        // We may race between queuing all those messages and the completion of the completion of
        // the first ones. So copy tthe values to avoid a ConcurrentModificationException
        return new ArrayList<>(files.values());
    }

