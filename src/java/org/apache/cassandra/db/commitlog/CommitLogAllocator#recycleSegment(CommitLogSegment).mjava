    /**
     * Indicates that a segment is no longer in use and that it should be recycled.
     *
     * @param segment segment that is no longer in use
     */
    public void recycleSegment(final CommitLogSegment segment)
    {
        activeSegments.remove(segment);

        if (isCapExceeded())
        {
            discardSegment(segment);
            return;
        }

        queue.add(new Runnable()
        {
            public void run()
            {
                CommitLogSegment recycled = segment.recycle();
                internalAddReadySegment(recycled);
            }
        });
    }

