    @Test
    public void testRecoverCounter() throws IOException, ExecutionException, InterruptedException
    {
        Keyspace keyspace1 = Keyspace.open("Keyspace1");

        RowMutation rm;
        DecoratedKey dk = Util.dk("key");
        ColumnFamily cf;

        for (int i = 0; i < 10; ++i)
        {
            cf = TreeMapBackedSortedColumns.factory.create("Keyspace1", "Counter1");
            cf.addColumn(new CounterCell(cellname("col"), 1L, 1L));
            rm = new RowMutation("Keyspace1", dk.key, cf);
            rm.apply();
        }

        keyspace1.getColumnFamilyStore("Counter1").clearUnsafe();

        CommitLog.instance.resetUnsafe(); // disassociate segments from live CL
        CommitLog.instance.recover();

        cf = Util.getColumnFamily(keyspace1, dk, "Counter1");

        assert cf.getColumnCount() == 1;
        Cell c = cf.getColumn(cellname("col"));

        assert c != null;
        assert ((CounterCell)c).total() == 10L;
    }

