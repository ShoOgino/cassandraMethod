    private void testByteBuffers() throws IOException
    {
        int n = RandomAccessReader.DEFAULT_BUFFER_SIZE;
        byte[] srcData = new byte[n];
        new Random().nextBytes(srcData);

        ByteBuffer src = makeBB(n);
        src.put(srcData, 0, n);
        src.flip();

        int outOffset = 5;
        ICompressor.WrappedByteBuffer compressed = makeWrappedBB(outOffset + compressor.initialCompressedBufferLength(srcData.length));
        byte[] garbage = new byte[compressed.buffer.capacity()];
        new Random().nextBytes(garbage);
        compressed.buffer.put(garbage);
        compressed.buffer.clear();
        compressed.buffer.position(outOffset);

        compressor.compress(src, compressed);
        compressed.buffer.flip();
        compressed.buffer.position(outOffset);

        ByteBuffer result = makeBB(outOffset + n);
        int decompressed = compressor.uncompress(compressed.buffer, result);

        assert decompressed == n;
        for (int i = 0; i < n; ++i)
            assert srcData[i] == result.get(i) : "Failed comparison on index: " + i + " with compressor: " + compressor.getClass().toString();
    }

