    /**
     * This method is responsible for creating Message to be
     * sent over the wire to N replicas where some of the replicas
     * may be hints.
     */
    private static Map<InetAddress, Message> createWriteMessages(RowMutation rm, Map<InetAddress, InetAddress> endpointMap) throws IOException
    {
        Map<InetAddress, Message> messageMap = new HashMap<InetAddress, Message>();
        Message message = rm.makeRowMutationMessage();

        for (Map.Entry<InetAddress, InetAddress> entry : endpointMap.entrySet())
        {
            InetAddress target = entry.getKey();
            InetAddress hint = entry.getValue();
            if ( !target.equals(hint) )
            {
                Message hintedMessage = rm.makeRowMutationMessage();
                hintedMessage.addHeader(RowMutation.HINT, hint.getAddress());
                if (logger.isDebugEnabled())
                    logger.debug("Sending the hint of " + hint + " to " + target);
                messageMap.put(target, hintedMessage);
            }
            else
            {
                messageMap.put(target, message);
            }
        }
        return messageMap;
    }

