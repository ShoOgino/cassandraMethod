    @Before
    public void prepare() throws Exception
    {
        if (!initialized)
        {
            LOCAL = FBUtilities.getLocalAddress();
            // bump the replication factor so that local overlaps with REMOTE below
            DatabaseDescriptorTest.setReplicationFactor(2);

            StorageService.instance.initServer();
            // generate a fake endpoint for which we can spoof receiving/sending trees
            TokenMetadata tmd = StorageService.instance.getTokenMetadata();
            IPartitioner part = StorageService.getPartitioner();
            REMOTE = InetAddress.getByName("127.0.0.2");
            tmd.updateNormalToken(part.getMinimumToken(), REMOTE);
            assert tmd.isMember(REMOTE);

            tablename = DatabaseDescriptor.getTables().iterator().next();
            cfname = Table.open(tablename).getColumnFamilies().iterator().next();
            initialized = true;
        }
        aes = AntiEntropyService.instance;
    }

